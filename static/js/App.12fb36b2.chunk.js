(this["webpackJsonpgatesolve-ui"]=this["webpackJsonpgatesolve-ui"]||[]).push([[0],{291:function(t,e,n){},292:function(t,e,n){},470:function(t,e,n){"use strict";n.r(e);var o=n(83),i=n.n(o),a=n(217),r=n(283),l=n(282),c=n(216),s=n(0),u=n.n(s),d=n(3),p=n(467),g=n(468),f=n(472),h=n(37),v=n(287),m=n(465),b=n(168),y=(n(289),n(290)),O={id:"route-line",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":["coalesce",["get","opacity"],.8],"line-width":2,"line-color":["get","color"]},filter:["!",["coalesce",["get","imaginary"],!1]]},w={id:"route-imaginary-line",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":["coalesce",["get","opacity"],.5],"line-width":5,"line-color":["get","color"],"line-dasharray":[0,2]},filter:["coalesce",["get","imaginary"],!1]},E={id:"route-point",type:"circle",paint:{"circle-opacity":["coalesce",["get","opacity"],1],"circle-radius":5,"circle-color":["get","color"]},filter:["==","Point",["geometry-type"]]},j={id:"building-highlight",type:"fill",paint:{"fill-opacity":.3,"fill-color":"#99ff99"}},x=[{id:"entrance-point",type:"circle",minzoom:12,maxzoom:15.999,paint:{"circle-radius":["interpolate",["linear"],["zoom"],12,1,14,2,15,3],"circle-color":"#64be14"}},{id:"entrance-symbol",type:"symbol",minzoom:16,paint:{"text-halo-color":"#fff","text-color":"#64be14","text-halo-width":1},layout:{"text-field":["format",["get","@house-label"],{},["case",["all",["has","@house-label"],["has","@entrance-label"]],"\u2009",""],{},["get","@entrance-label"],{"text-font":["literal",["Klokantech Noto Sans Bold"]]}],"text-font":["Klokantech Noto Sans Regular"],"text-size":16,"text-offset":["get","@offset"],"text-anchor":["step",["%",["get","@rotate"],360]].concat(function(){var t=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"];return[t[0]].concat([22.5,67.5,112.5,157.5,202.5,247.7,292.5,337.5].flatMap((function(e,n){return[e,t[(0+n+1)%t.length]]})))}()),"text-rotation-alignment":"map","text-allow-overlap":!0,"text-ignore-placement":!0,"icon-image":"icon-svg-triangle-14-#64be14-#fff","icon-anchor":"bottom","icon-rotate":["get","@rotate"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}],C={id:"route-point-symbol",type:"symbol",paint:{"text-color":"#000","text-halo-color":"#fff","text-halo-width":3},layout:{"text-field":["get","ref"],"text-anchor":"center","text-font":["Klokantech Noto Sans Regular"],"text-size":24,"text-offset":[0,-.05]},filter:["==","Point",["geometry-type"]]},M="M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73c1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z",k=function(t,e){return'\n<svg xmlns="http://www.w3.org/2000/svg"\n  width="'.concat(t,'px"\n  height="').concat(t,'px"\n  style="').concat(e,'"\n  viewBox="').concat("-1 -1 17 17",'"\n>\n  <path d="').concat(M,'" />\n</svg>')},P=function(t){var e=t.height,n=void 0===e?"50":e,o=t.style,i=void 0===o?{fill:"#444",stroke:"none"}:o,a=t.dataTestId;return u.a.createElement("svg",{"data-testid":a,height:n,style:i,viewBox:"-1 -1 17 17",pointerEvents:"none"},u.a.createElement("path",{fill:"url(#gradient-".concat(i.fill,")"),d:M,pointerEvents:"visiblepainted",cursor:"pointer"}),u.a.createElement("defs",null,u.a.createElement("linearGradient",{id:"gradient-".concat(i.fill),gradientTransform:"rotate(90)"},u.a.createElement("stop",{offset:"00%",stopColor:"#FFFFFF",stopOpacity:"0"}),u.a.createElement("stop",{offset:"100%",stopColor:i.fill,stopOpacity:"1"}))))},S=function(t,e){return'\n<svg xmlns="http://www.w3.org/2000/svg"\n  width="'.concat(t,'px"\n  height="').concat(t,'px"\n  style="').concat(e,'"\n  viewBox="').concat("-5 -1 25 25",'"\n>\n  <path d="').concat("M 8 16 L 0 8 L 16 8 Z",'" />\n</svg>')},L=function(t){var e=t.dataTestId,n=t.width,o=void 0===n?"40":n,i=t.height,a=void 0===i?"40":i,r=t.stroke,l=void 0===r?"#00afff":r,c=t.strokeWidth,s=void 0===c?"16":c;return u.a.createElement("svg",{"data-testid":e,width:o,height:a,stroke:l,strokeWidth:s,viewBox:"-100 -100 200 200",fill:"transparent",style:{position:"absolute"}},u.a.createElement("circle",{cx:"0",cy:"0",r:"24"}),u.a.createElement("circle",{cx:"0",cy:"0",r:"46"}),u.a.createElement("circle",{cx:"0",cy:"0",r:"68"}))},T=function(t){var e=t.dataTestId,n=t.onGeolocate,o=t.onGeolocateError,i=t.positionOptions,a=void 0===i?{enableHighAccuracy:!0,timeout:6e3}:i,r=t.onEnable,l=t.onDisable,d=t.enableOnMount,p=void 0===d||d,g=Object(s.useState)(null!=window.navigator.geolocation),f=Object(c.a)(g,1)[0],h=Object(s.useState)(null!=window.navigator.permissions),v=Object(c.a)(h,1)[0],m=Object(s.useState)(null),b=Object(c.a)(m,2),y=b[0],O=b[1],w=Object(s.useState)(null),E=Object(c.a)(w,2),j=E[0],x=E[1],C=Object(s.useState)(!1),M=Object(c.a)(C,2),k=M[0],P=M[1],S=function(t){f&&null==j&&(x(window.navigator.geolocation.watchPosition(n,o,a)),P(!0),null!=r&&r(t))},L=function(){f&&null!=j&&(window.navigator.geolocation.clearWatch(j),x(null),null!=l&&l())},T=function(){console.log("Geolocation is denied. Inform the user.")};Object(s.useEffect)((function(){f||console.log("Geolocation is not supported. Inform the user.")}),[f]),Object(s.useEffect)((function(){f&&v&&null==y&&v&&window.navigator.permissions.query({name:"geolocation"}).then((function(t){O(t.state),t.onchange=function(){O(this.state)}})).catch((function(t){console.error("Permissions API exists but querying it fails:",t)}))}),[]),Object(s.useEffect)((function(){"denied"===y&&(T(),L())}),[y]);var F=!v||null!=y,N=null!=j;Object(s.useEffect)((function(){!p||k||!f||N||v&&(null==y||"denied"===y)||S(!1)}),[p,k,f,N,v,y]);var I=null;if(f){var W=N?"Stop using my location":"Find my location",z=N?"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate mapboxgl-ctrl-geolocate-active":"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate";I=u.a.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group mapboxgl-ctrl-bottom-left"},u.a.createElement("button",{type:"button",className:z,"data-testid":e,"aria-label":W,"aria-pressed":N,onContextMenu:function(t){return t.preventDefault()},onClick:F?function(t){console.assert(f),console.assert(F),t.preventDefault(),N?L():v&&"denied"===y?T():S(!0)}:void 0},u.a.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"})))}return I};function F(t){var e=[],n=[],o=new Map,i=[];return t.legs[0].getSteps().forEach((function(a,r){var l,c;if(a.startLocation.id||a.stopLocation.id||1===r){var s=a.stopLocation;"https://w3id.org/openstreetmap/terms#Steps"===(null===(l=t.context[a.through])||void 0===l?void 0:l.definedTags["https://w3id.org/openstreetmap/terms#highway"])&&(o.has(a.through)||o.set(a.through,[]),o.get(a.through).push([a.startLocation.longitude,a.startLocation.latitude],[a.stopLocation.longitude,a.stopLocation.latitude])),(null===(c=s.definedTags)||void 0===c?void 0:c["https://w3id.org/openstreetmap/terms#barrier"])&&(console.log(a.through,s.definedTags["https://w3id.org/openstreetmap/terms#barrier"].replace(/^.*#/,""),s.id,s.definedTags,s.freeformTags),n.push([s.longitude,s.latitude])),e.push([a.startLocation.longitude,a.startLocation.latitude]),e.push([a.stopLocation.longitude,a.stopLocation.latitude])}else i.push([[a.startLocation.longitude,a.startLocation.latitude],[a.stopLocation.longitude,a.stopLocation.latitude]])})),{coordinates:e,obstacles:n,obstacleWays:Array.from(o.values()),imaginaryWays:i}}function N(t,e,n,o){var i=[];return t&&i.push({type:"Feature",geometry:{type:"Point",coordinates:[t[1],t[0]]},properties:{color:"#00afff"}}),e&&e.forEach((function(t){i.push({type:"Feature",geometry:{type:"Point",coordinates:[t.lon,t.lat]},properties:{color:"#64be14"}})})),n&&n.forEach((function(t){var e,n;i.push({type:"Feature",geometry:{type:"Point",coordinates:[t.lon,t.lat]},properties:{color:"#00ffff",ref:(null===(e=t.tags)||void 0===e?void 0:e.ref)||(null===(n=t.tags)||void 0===n?void 0:n["addr:unit"]),opacity:0}})})),(null===o||void 0===o?void 0:o.coordinates)&&i.push({type:"Feature",geometry:{type:"LineString",coordinates:o.coordinates},properties:{color:"#000"}}),(null===o||void 0===o?void 0:o.obstacleWays)&&i.push({type:"Feature",geometry:{type:"MultiLineString",coordinates:o.obstacleWays},properties:{color:"#dc0451",opacity:1}}),(null===o||void 0===o?void 0:o.imaginaryWays)&&i.push({type:"Feature",geometry:{type:"MultiLineString",coordinates:o.imaginaryWays},properties:{color:"#000",imaginary:!0}}),(null===o||void 0===o?void 0:o.obstacles)&&i.push({type:"Feature",geometry:{type:"MultiPoint",coordinates:o.obstacles},properties:{color:"#dc0451",ref:"!"}}),{type:"FeatureCollection",features:i}}function I(){return(I=Object(a.a)(i.a.mark((function t(e,o,r){var l,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(4),n.e(2)]).then(n.bind(null,469));case 2:l=t.sent,c=l.Planner,o.forEach((function(t){var n=new c;n.setProfileID("".concat("https","://").concat("","/delivery.json")).query({from:{latitude:e[0],longitude:e[1]},to:{latitude:t.lat,longitude:t.lon}}).take(1).on("data",function(){var o=Object(a.a)(i.a.mark((function o(a){var l,c,s;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.completePath(a);case 2:l=o.sent,console.log("Plan",l,"from",e,"to",t),c=F(l),s=N(e,[t],void 0,c),r(s);case 7:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}())}));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var W=function(t){var e,n;return{width:null===t||void 0===t||null===(e=t.getContainer())||void 0===e?void 0:e.clientWidth,height:null===t||void 0===t||null===(n=t.getContainer())||void 0===n?void 0:n.clientHeight}},z=function(t,e,n,o,i){if(t["osm:hasNodes"]&&"string"!==typeof t["osm:hasNodes"]){var a=t["osm:hasNodes"];if(a.length<4)console.log("not an area",t["@id"]);else{a[0]!==a[a.length-1]&&console.log("unclosed",t["@id"]);var l=null;a.forEach((function(a,c,s){var u=n[a];if(u){null===l&&(l=Object(b.booleanClockwise)(Object(b.lineString)(s.map((function(t){return e[t]})))));var d=e[a],p=0===c?e[s[s.length-2]]:e[s[c-1]],g=c===s.length-1?e[s[1]]:e[s[c+1]],f=Object(b.bearing)(d,p),h=Object(b.bearing)(d,g),v=Math.abs(f-h)/2+Math.min(f,h),m=f>h?v+270:v+90,y=l!==!!o?m:m+180,O=u.properties["@entrance-label"],w=u.properties["@house-label"];if(!u.properties["addr:housenumber"]&&!u.properties.ref&&!u.properties["addr:unit"]){var E=R(i||t);O=O||E.entrance}u.properties=Object(r.a)({},u.properties,{"@offset":[.2*Math.cos(y/180*Math.PI),.2*Math.sin(y/180*Math.PI)],"@rotate":((y-90)%360+360)%360,"@entrance-label":O,"@house-label":w})}}))}}},R=function(t){var e,n,o,i,a,r,l=(null===(e=t["osm:hasTag"])||void 0===e||null===(n=e.find((function(t){return t.startsWith("addr:housenumber=")})))||void 0===n?void 0:n.substring(17))||"",c=null===(o=t["osm:hasTag"])||void 0===o||null===(i=o.find((function(t){return t.startsWith("ref=")})))||void 0===i?void 0:i.substring(4),s=null===(a=t["osm:hasTag"])||void 0===a||null===(r=a.find((function(t){return t.startsWith("addr:unit=")})))||void 0===r?void 0:r.substring(10),u=c||s||"";return{house:l.replace(/ /g,"\u2009"),entrance:u.replace(/ /g,"\u2009")}},G=function(t){for(var e={},n={},o={},i={},a=0;a<t["@graph"].length;a++){var r=t["@graph"][a];if("osm:Relation"===r["@type"])i[r["@id"]]=r;else if("osm:Way"===r["@type"])o[r["@id"]]=r;else if(r["geo:lat"]&&r["geo:long"]){var l,c=[r["geo:long"],r["geo:lat"]];n[r["@id"]]=c,(null===(l=r["osm:hasTag"])||void 0===l?void 0:l.find((function(t){return t.startsWith("entrance=")})))&&function(){var t=R(r),n={id:r["@id"],type:"Feature",geometry:{type:"Point",coordinates:c},properties:{"@id":r["@id"],"@entrance-label":t.entrance,"@house-label":t.house}};r["osm:hasTag"].forEach((function(t){var e=t.indexOf("=");n.properties[t.substring(0,e)]=t.substring(e+1)})),e[n.properties["@id"]]=n}()}}return function(t,e,n,o){Object.values(t).filter((function(t){var e;return null===(e=t["osm:hasTag"])||void 0===e?void 0:e.find((function(t){return t.startsWith("building=")||t.startsWith("building:part=")}))})).forEach((function(t){t["osm:hasMembers"].forEach((function(i){var a=e[i["@id"]];a&&z(a,n,o,"inner"===i.role,t)}))}))}(i,o,n,e),function(t,e,n){Object.values(t).filter((function(t){var e;return null===(e=t["osm:hasTag"])||void 0===e?void 0:e.find((function(t){return t.startsWith("building=")||t.startsWith("building:part=")}))})).forEach((function(t){z(t,e,n)}))}(o,n,e),{type:"FeatureCollection",features:Object.values(e)}},D=12756274*Math.PI;function q(t,e,n,o){for(var i=function(t){var e=D*t[0]/360,n=Math.sin(t[1]*Math.PI/180),o=D*Math.log((1+n)/(1-n))/(4*Math.PI);return[D/2+e,D-(D/2+o)]}(n),a=[256*i[0]*Math.pow(2,o)/D,256*i[1]*Math.pow(2,o)/D],r=[Math.floor((a[0]-t/2)/256),Math.floor((a[1]-e/2)/256),Math.ceil((a[0]+t/2)/256),Math.ceil((a[1]+e/2)/256)],l=[],c=r[0];c<r[2];++c)for(var s=r[1];s<r[3];++s){var u=256*c-a[0]+t/2,d=256*s-a[1]+e/2;l.push({x:c,y:s,zoom:o,px:u,py:d})}return l}n(291),n(292);var A=function(t){return{id:-1,type:"node",lat:t[0],lon:t[1]}},B=function(t){return[t.lat,t.lon]},K={entrances:[],route:N(),highlights:{type:"FeatureCollection",features:[]},viewport:{latitude:60.17,longitude:24.941,zoom:15,bearing:0,pitch:0},isOriginExplicit:!1,isGeolocating:!1,geolocationPosition:null,popupCoordinates:null,routableTiles:new Map},H=[60.17066815612902,24.941510260105133],U=function(t){return{url:t.replace("https://static.hsldev.com/mapfonts/Klokantech Noto Sans","https://fonts.openmaptiles.org/Klokantech Noto Sans")}},J=function(t,e){return Object(b.distance)([t[1],t[0]],[e[1],e[0]],{units:"metres"})},Z=function(t){if(t){var e=t.split(",");if(2===e.length&&e[0].length&&e[1].length){var n=e.map(Number),o=Object(c.a)(n,2),i=o[0],a=o[1];if(!Number.isNaN(i)&&a>-90&&a<90)return[i,a]}}},_=function(t,e){var n=new m.a(t),o=e.filter((function(t){return t}));if(!o.length)return t;var i=Math.min.apply(Math,Object(l.a)(o.map((function(t){return t[1]})))),a=Math.max.apply(Math,Object(l.a)(o.map((function(t){return t[1]})))),r=Math.min.apply(Math,Object(l.a)(o.map((function(t){return t[0]})))),c=Math.max.apply(Math,Object(l.a)(o.map((function(t){return t[0]}))));return n.fitBounds([[i,r],[a,c]],{padding:{top:110,bottom:25,left:45,right:45},maxZoom:17})};e.default=function(){var t,e,n,o,l,m,b,M,F,z,R,D,V=Object(s.useRef)(null),Q=Object(s.useRef)(null);Object(s.useEffect)((function(){if(V.current){var t=V.current.getMap();null===t||void 0===t||t.on("styleimagemissing",(function(e){var n=e.id;if(null===n||void 0===n?void 0:n.startsWith("icon-svg-")){var o,i=n.split("-"),a=Object(c.a)(i,6),r=a[2],l=a[3],s=a[4],u=a[5];if("pin"===r)o=k;else{if("triangle"!==r)return;o=S}var d=o(l,"fill: ".concat(s,"; stroke: ").concat(u));!function(t,e,n,o){var i=window.devicePixelRatio,a=document.createElement("canvas");a.width=i*o,a.height=i*o;var r=a.getContext("2d"),l=new Image(o,o),c="data:image/svg+xml,".concat(encodeURIComponent(n));l.onload=function(){if(!r)throw Error("canvas.getContext failed");r.drawImage(l,0,0,i*o,i*o),t.addImage(e,r.getImageData(0,0,i*o,i*o),{pixelRatio:i})},l.src=c}(t,n,d,l)}}))}}),[V]);var X=Object(d.e)({path:"/route/:from?/:to?"}),Y=Object(s.useState)(K),$=Object(c.a)(Y,2),tt=$[0],et=$[1],nt=function(t,e){var n;return _(Object(r.a)({},t,{},W(null===(n=V.current)||void 0===n?void 0:n.getMap())),e)};Object(s.useEffect)((function(){if(V.current&&tt.viewport.zoom&&!(tt.viewport.zoom<12)){var t=W(V.current.getMap()),e=t.width,n=t.height,o=Math.pow(2,13-tt.viewport.zoom),l=q(o*e,o*n,[tt.viewport.longitude,tt.viewport.latitude],14),c=new Map;l.forEach((function(t){var e=t.zoom,n=t.x,o=t.y,i="".concat(e,"/").concat(n,"/").concat(o);c.set(i,tt.routableTiles.get(i)||null)})),et((function(t){return Object(r.a)({},t,{routableTiles:c})})),l.map(function(){var t=Object(a.a)(i.a.mark((function t(e){var n,o,a,l,s,u,d;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.zoom,o=e.x,a=e.y,l="".concat(n,"/").concat(o,"/").concat(a),null===c.get(l)){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,fetch("https://tile.olmap.org/building-tiles/".concat(n,"/").concat(o,"/").concat(a));case 6:return s=t.sent,t.next=9,s.json();case 9:u=t.sent,d=G(u),et((function(t){if(null!==t.routableTiles.get(l))return t;var e=new Map(t.routableTiles);return e.set(l,d),Object(r.a)({},t,{routableTiles:e})}));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}),[V.current,tt.viewport]),Object(s.useEffect)((function(){if(V.current){var t=W(V.current.getMap()),e=t.width,n=t.height;if(X&&null!=e&&e>0&&null!=n&&n>0){var o=Z(X.params.from),i=Z(X.params.to),a=Object(r.a)({},tt.viewport,{width:e,height:n}),l=_(a,[o,i]);et((function(t){return Object(r.a)({},t,{origin:o,isOriginExplicit:null!=o,destination:i&&A(i),viewport:Object(r.a)({},t.viewport,{},l)})}))}}}),[V]);var ot=Object(d.d)(),it=Object(h.b)(),at=null===it||void 0===it?void 0:it.enqueueSnackbar,rt=null===it||void 0===it?void 0:it.closeSnackbar;Object(s.useEffect)((function(){var t=tt.destination&&[tt.destination.lat,tt.destination.lon],e="/route/".concat(tt.origin,"/").concat(t,"/");ot.location.pathname!==e&&ot.replace(e)}),[ot,tt.origin,tt.destination]),Object(s.useEffect)((function(){tt.destination&&function(t){var e,n,o=new URL("https://overpass.rwqr.org/api/interpreter");return o.searchParams.append("data",(e=t.lat,n=t.lon,"\n  [out:json][timeout:25];\n  (\n    relation(around:10, ".concat(e,", ").concat(n,")[building];\n    way(r);\n    way(around:10, ").concat(e,", ").concat(n,')[building];\n  )->.b;\n  (\n    relation(around.b:10)["building:part"];\n    way(r);\n    way(around.b:10)["building:part"];\n  )->.p;\n  // gather results\n  (\n    node(w.b)[entrance];\n    node(w.p)[entrance];\n  );\n  // print results\n  out body;\n  >;\n  out skel qt;\n'))),fetch(o.toString()).then((function(t){return t.json().then((function(t){return t.elements.filter((function(t){return"node"===t.type&&"lat"in t&&null!=t.lat&&"lon"in t&&null!=t.lon&&t.tags&&t.tags.entrance}))}))}))}(tt.destination).catch((function(t){return console.error("Error while fetching building entrances:",t),[]})).then((function(t){et((function(e){if(!tt.destination)return e;if(e.destination!==tt.destination)return e;var n=t.length?t:[tt.destination];return Object(r.a)({},e,{entrances:n})}))})).catch((function(t){console.error("Error while handling entrances:",t)}))}),[tt.destination]),Object(s.useEffect)((function(){if(tt.snackbar&&rt(tt.snackbar),tt.origin&&tt.destination&&tt.entrances){var t=[];if(tt.entrances.forEach((function(e){tt.destination&&tt.destination.type===e.type&&tt.destination.id===e.id&&(t=[e])})),t.length||(t=tt.entrances),et((function(t){return Object(r.a)({},t,{route:N()})})),J(tt.origin,B(tt.destination))>200){var e=tt.isOriginExplicit?"Origin is too far for showing routes.":"Routes show when distance is shorter.",n=at(e,{variant:"info",persist:!0,anchorOrigin:{vertical:"bottom",horizontal:"center"},action:u.a.createElement(u.a.Fragment,null,tt.isOriginExplicit&&u.a.createElement(p.a,{color:"inherit",onClick:function(){et((function(t){return Object(r.a)({},t,{origin:t.geolocationPosition||void 0,isOriginExplicit:!1,viewport:nt(t.viewport,[t.destination&&B(t.destination)])})}))}},"Undo origin"),u.a.createElement(p.a,{color:"inherit",onClick:function(){et((function(t){return Object(r.a)({},t,{destination:void 0,entrances:[],viewport:nt(t.viewport,[t.origin])})}))}},"Undo destination"),u.a.createElement(p.a,{color:"inherit",target:"_blank",rel:"noreferrer",href:"https://www.google.com/maps/dir/?api=1&origin=".concat(tt.origin[0],",").concat(tt.origin[1],"&destination=").concat(tt.destination.lat,",").concat(tt.destination.lon,"&travelmode=driving")},"Google Maps"),u.a.createElement(g.a,{"aria-label":"close",onClick:function(){return rt(n)}},u.a.createElement(f.a,null)))});et((function(t){return Object(r.a)({},t,{snackbar:n})}))}else(function(t,e,n){return I.apply(this,arguments)})(tt.origin,t,(function(t){et((function(e){if(tt.origin!==e.origin||tt.entrances!==e.entrances||tt.destination!==e.destination)return e;var n=Object(r.a)({},t,{features:t.features.concat(e.route.features)});return Object(r.a)({},e,{route:n})}))})).catch((function(t){console.error("Error while starting route planning:",t)}))}}),[tt.origin,tt.entrances]);var lt=function(t){var e,n=null===(e=V.current)||void 0===e?void 0:e.getMap().queryRenderedFeatures(t.point)[0];et((function(e){if(null===n||void 0===n?void 0:n.properties.entrance){var o={id:n.properties["@id"],type:n.properties["@type"],lat:n.geometry.coordinates[1],lon:n.geometry.coordinates[0],tags:n.properties};return e.origin&&J(e.origin,[n.geometry.coordinates[1],n.geometry.coordinates[0]])<200?Object(r.a)({},e,{destination:o,popupCoordinates:o,highlights:{type:"FeatureCollection",features:[]}}):Object(r.a)({},e,{popupCoordinates:o})}return"building"===(null===n||void 0===n?void 0:n.sourceLayer)?Object(r.a)({},e,{highlights:n.toJSON(),destination:A([t.lngLat.lat,t.lngLat.lng])}):e.popupCoordinates?Object(r.a)({},e,{popupCoordinates:null}):Object(r.a)({},e,{popupCoordinates:A([t.lngLat.lat,t.lngLat.lng]),highlights:{type:"FeatureCollection",features:[]}})}))};return u.a.createElement("div",{"data-testid":"app",className:"App"},u.a.createElement("header",{className:"App-header"},u.a.createElement("h2",null,"Gatesolve")),u.a.createElement("div",{className:"App-shadow"}),u.a.createElement(y.ReactAutosuggestGeocoder,{ref:Q,url:"https://api.digitransit.fi/geocoding/v1",sources:"oa,osm,nlsfi",highlightFirstSuggestion:!0,inputProps:{placeholder:"Destination name or address"},center:{latitude:(null===(t=tt.geolocationPosition)||void 0===t?void 0:t[0])||(null===(e=tt.origin)||void 0===e?void 0:e[0])||(null===(n=tt.destination)||void 0===n?void 0:n.lat)||H[0],longitude:(null===(o=tt.geolocationPosition)||void 0===o?void 0:o[1])||(null===(l=tt.origin)||void 0===l?void 0:l[1])||(null===(m=tt.destination)||void 0===m?void 0:m.lon)||H[1]},onSuggestionSelected:function(t,e){var n=e.suggestion,o=[n.geometry.coordinates[1],n.geometry.coordinates[0]],i=n.properties.source_id.split(":"),a=Object(c.a)(i,2),l=a[0],s=a[1];et((function(t){var e=t.origin&&J(t.origin,o)<200?[t.origin,o]:[o],n=nt(t.viewport,e);return Object(r.a)({},t,{origin:t.origin,destination:{lat:o[0],lon:o[1],type:l,id:Number(s)},entrances:[],viewport:Object(r.a)({},t.viewport,{},n)})}))}}),u.a.createElement(v.e,Object.assign({ref:V},tt.viewport,{style:{width:"100%",height:"90%"},mapStyle:"https://raw.githubusercontent.com/HSLdevcom/hsl-map-style/master/simple-style.json",dragRotate:!1,transformRequest:U,onViewportChange:function(t){et((function(e){return Object(r.a)({},e,{viewport:t})}))},onHover:function(t){var e,n=null===(e=t.features)||void 0===e?void 0:e[0],o=(null===n||void 0===n?void 0:n.properties.entrance)?"pointer":"grab",i=document.querySelector(".overlays");i&&(i.style.cursor=o)},onClick:lt,onContextmenu:lt}),u.a.createElement(T,{dataTestId:"geolocate-control",enableOnMount:!0,onEnable:function(t){et((function(e){return Object(r.a)({},e,{isOriginExplicit:!t&&e.isOriginExplicit,isGeolocating:!0})}))},onDisable:function(){et((function(t){return Object(r.a)({},t,{isGeolocating:!1,geolocationPosition:null})}))},onGeolocate:function(t){return et((function(e){if(e.isGeolocating){var n=null==e.geolocationPosition,o=[t.coords.latitude,t.coords.longitude],i=n&&!e.isOriginExplicit?nt(e.viewport,[o,e.destination&&B(e.destination)]):e.viewport,a=Object(r.a)({},e,{geolocationPosition:o,viewport:i});return!e.isOriginExplicit&&(null==e.origin||J(e.origin,o)>20)?Object(r.a)({},a,{origin:o}):a}return e}))}}),null!=tt.geolocationPosition&&u.a.createElement(v.b,{offset:[-20,-20],longitude:tt.geolocationPosition[1],latitude:tt.geolocationPosition[0]},u.a.createElement(L,{dataTestId:"user-marker"})),Array.from(tt.routableTiles.entries(),(function(t){var e=Object(c.a)(t,2),n=e[0],o=e[1];return o&&u.a.createElement(v.d,{key:n,id:"source-".concat(n),type:"geojson",data:o},x.map((function(t){return u.a.createElement(v.a,Object.assign({},t,{key:"".concat(t.id,"-").concat(n),id:"".concat(t.id,"-").concat(n),source:"source-".concat(n)}))})))})),u.a.createElement(v.d,{id:"highlights",type:"geojson",data:tt.highlights},u.a.createElement(v.a,Object.assign({},j,{source:"highlights"}))),u.a.createElement(v.d,{id:"route",type:"geojson",data:tt.route},u.a.createElement(v.a,Object.assign({},O,{source:"route"})),u.a.createElement(v.a,Object.assign({},w,{source:"route"})),u.a.createElement(v.a,Object.assign({},E,{source:"route"})),u.a.createElement(v.a,Object.assign({},C,{source:"route"}))),tt.origin&&u.a.createElement(v.b,{className:"PinMarker",draggable:!0,offset:[0,-22.5],onDragEnd:function(t){et((function(e){return Object(r.a)({},e,{origin:[t.lat,t.lng],isOriginExplicit:!0})}))},longitude:tt.origin[1],latitude:tt.origin[0]},u.a.createElement(P,{dataTestId:"origin",style:{fill:"#00afff",stroke:"#fff"}})),tt.destination&&u.a.createElement(v.b,{className:"PinMarker",draggable:!0,offset:[0,-22.5],onDragEnd:function(t){Q.current.clear(),et((function(e){return Object(r.a)({},e,{destination:A([t.lat,t.lng])})}))},longitude:tt.destination.lon,latitude:tt.destination.lat},u.a.createElement(P,{dataTestId:"destination",style:{fill:"#64be14",stroke:"#fff"}})),u.a.createElement(v.c,{open:null!=tt.popupCoordinates,latitude:(null===(b=tt.popupCoordinates)||void 0===b?void 0:b.lat)||null,longitude:(null===(M=tt.popupCoordinates)||void 0===M?void 0:M.lon)||null,closeButton:!1,closeOnClick:!1},tt.popupCoordinates&&u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,u.a.createElement("h3",null,null===(F=tt.popupCoordinates.tags)||void 0===F?void 0:F["addr:street"]," ",null===(z=tt.popupCoordinates.tags)||void 0===z?void 0:z["addr:housenumber"]," ",(null===(R=tt.popupCoordinates.tags)||void 0===R?void 0:R.ref)||(null===(D=tt.popupCoordinates.tags)||void 0===D?void 0:D["addr:unit"])),u.a.createElement("p",null,tt.popupCoordinates.tags&&u.a.createElement("table",{style:{textAlign:"left"}},u.a.createElement("tbody",null,Object.entries(tt.popupCoordinates.tags).filter((function(t){var e=Object(c.a)(t,1)[0];return!e.startsWith("@")&&!["addr:street","addr:housenumber","addr:unit","ref"].includes(e)})).map((function(t){var e=Object(c.a)(t,2),n=e[0],o=e[1];return u.a.createElement("tr",{key:"".concat(n,"-").concat(o)},u.a.createElement("td",{style:{padding:"0 5px 0 0"}},n),u.a.createElement("td",null,o))})))))),u.a.createElement(p.a,{"data-testid":"origin-button",variant:"contained",size:"small",style:{backgroundColor:"#00afff",color:"#fff"},type:"button","aria-label":"Set origin",onClick:function(){return et((function(t){return null!=t.popupCoordinates?Object(r.a)({},t,{origin:B(t.popupCoordinates),isOriginExplicit:!0,popupCoordinates:null}):Object(r.a)({},t,{isOriginExplicit:!0,popupCoordinates:null})}))}},"Origin"),u.a.createElement("span",{style:{padding:"5px"}}),u.a.createElement(p.a,{"data-testid":"destination-button",variant:"contained",size:"small",style:{backgroundColor:"#64be14",color:"#fff"},type:"button","aria-label":"Set destination",onClick:function(){return et((function(t){return null!=t.popupCoordinates?Object(r.a)({},t,{destination:t.popupCoordinates,popupCoordinates:null}):Object(r.a)({},t,{popupCoordinates:null})}))}},"Destination")))))}}},0,[4,2]]);
//# sourceMappingURL=App.12fb36b2.chunk.js.map