(this["webpackJsonpgatesolve-ui"]=this["webpackJsonpgatesolve-ui"]||[]).push([[0],{326:function(e,t,n){},327:function(e,t,n){},521:function(e,t,n){"use strict";n.r(t);var o,a,i,r,c,l=n(96),s=n.n(l),u=n(185),d=n(183),p=n(200),f=n(157),g=n(0),b=n(3),h=n(518),v=n(507),j=n(508),m=n(519),O=n(41),x=n(320),y=n(498),w=n(242),k=(n(322),n(323)),C=n(324),_=function(e){return["literal",e]},E=function(e){return["has",e]},P=function(e){return["get",e]},S=function(e){return["var",e]},M=function(e){return["to-boolean",e]},D=function(e){return["!",e]},T=function(e){return["length",e]},N=function(e,t){return[">",e,t]},L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["any"].concat(t)},F=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["all"].concat(t)},W=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["coalesce"].concat(t)},A=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["format"].concat(Object(p.a)(t.flatMap((function(e){return Object(C.a)(e).slice(0)}))))},I=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["case"].concat(Object(p.a)(t.flatMap((function(e){return Object(C.a)(e).slice(0)}))))},R=[{id:"venue-symbol",type:"symbol",paint:{"text-halo-color":"#fff","text-color":"#af8dbc","text-halo-width":2},layout:{"text-field":["get","@label"],"text-anchor":"center","text-font":["Klokantech Noto Sans Regular"],"text-size":20,"text-offset":[0,-1.55],"text-allow-overlap":!0,"text-ignore-placement":!0,"icon-image":"icon-svg-pin-48-#af8dbc-#fff","icon-anchor":"bottom","icon-allow-overlap":!0,"icon-ignore-placement":!0}}],z=[{id:"route-line",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":["coalesce",["get","@opacity"],.8],"line-width":2,"line-color":["get","@color"]},filter:["!",["coalesce",["get","@imaginary"],!1]]},{id:"route-line-interactive",type:"line",paint:{"line-width":16,"line-opacity":0},filter:["coalesce",["get","@interactive"]]}],U={id:"route-imaginary-line",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":["coalesce",["get","@opacity"],.5],"line-width":5,"line-color":["get","@color"],"line-dasharray":[0,2]},filter:["coalesce",["get","@imaginary"],!1]},G={id:"route-point",type:"circle",paint:{"circle-opacity":["coalesce",["get","@opacity"],1],"circle-radius":5,"circle-color":["get","@color"]},filter:["==","Point",["geometry-type"]]},B={id:"building-highlight",type:"fill",paint:{"fill-opacity":.3,"fill-color":"#99ff99"}},K=["let","maybe_space",I([F(E("@house-label"),E("@entrance-label")),"\u2009"],[""]),"house_label_maybe_space",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return["concat"].concat(t)}(P("@house-label"),I([F(E("@house-label"),E("@entrance-label")),"\u2009"],[""])),["step",["zoom"],(a=S("maybe_space"),A([I([D(M(P("@house-label"))),""],[L(W(P("@secondary"),!1),N(T(P("@house-label")),3)),"\xb7"],[P("@house-label")]),{}],[a,{}],[I([D(M(P("@entrance-label"))),""],[F(W(P("@secondary"),!1)),"\xb7"],[P("@entrance-label")]),{"text-font":["literal",["Klokantech Noto Sans Bold"]]}])),17,function(e){return A([I([(t="@house-label",D(M(P(t)))),""],[L(W(P("@secondary"),!1),N(T(P("@house-label")),3)),"\xb7"],[P("@house-label")]),{}],[e,{}],[I([D(M(P("@entrance-label"))),""],[F(W(P("@secondary"),!1),N(T(P("@entrance-label")),1)),"\xb7"],[P("@entrance-label")]),{"text-font":["literal",["Klokantech Noto Sans Bold"]]}]);var t}(S("maybe_space")),18,(o=S("house_label_maybe_space"),A([o,{}],[P("@entrance-label"),{"text-font":["literal",["Klokantech Noto Sans Bold"]]}]))]],q=function(e){var t=e.missing,n=e.visible,o=e.hidden;return["step",["zoom"],I([D(L(M(P("@house-label")),M(P("@entrance-label")))),t],[F(D(F(M(P("@house-label")),D(M(P("@secondary"))),D(N(T(P("@house-label")),3)))),D(F(M(P("@entrance-label")),D(M(P("@secondary")))))),o],[n]),17,I([D(L(M(P("@house-label")),M(P("@entrance-label")))),t],[F(D(F(M(P("@house-label")),D(M(P("@secondary"))),D(N(T(P("@house-label")),3)))),D(F(M(P("@entrance-label")),L(D(M(P("@secondary"))),D(N(T(P("@entrance-label")),1)))))),o],[n]),18,I([D(L(M(P("@house-label")),M(P("@entrance-label")))),t],[n])]},H=function(e,t){return q({missing:t,visible:e,hidden:t})},J=[{id:"entrance-point",type:"circle",minzoom:12,maxzoom:16,paint:{"circle-radius":["interpolate",["linear"],["zoom"],12,1,14,2,15,3],"circle-color":"#64be14"}},{id:"entrance-symbol",type:"symbol",minzoom:16,paint:{"text-halo-color":"#fff","text-color":"#64be14","text-halo-width":1,"icon-opacity":H(_(1),_(.5)),"text-opacity":H(_(1),_(0))},layout:{"text-field":K,"text-font":["Klokantech Noto Sans Regular"],"text-size":16,"text-offset":["get","@offset"],"text-anchor":["step",["%",["get","@rotate"],360]].concat(function(){var e=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"];return[e[0]].concat([22.5,67.5,112.5,157.5,202.5,247.7,292.5,337.5].flatMap((function(t,n){return[t,e[(0+n+1)%e.length]]})))}()),"text-rotation-alignment":"map","text-allow-overlap":!0,"text-ignore-placement":!0,"icon-image":(i=_("icon-svg-triangleDot-28-#64be14-#fff"),r=_("icon-svg-triangle-28-#64be14-#fff"),q({missing:r,visible:r,hidden:i})),"icon-anchor":"center","icon-rotate":["get","@rotate"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}],V={id:"route-point-symbol",type:"symbol",paint:{"text-color":"#000","text-halo-color":"#fff","text-halo-width":3},layout:{"text-field":["get","@label"],"text-anchor":"center","text-font":["Klokantech Noto Sans Regular"],"text-size":24,"text-offset":[0,-.05]},filter:["==","Point",["geometry-type"]]},Z=n(9),$="-1 -1 17 17",X="M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73c1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z",Q=function(e,t){return'\n<svg xmlns="http://www.w3.org/2000/svg"\n  width="'.concat(e,'px"\n  height="').concat(e,'px"\n  style="').concat(t,'"\n  viewBox="').concat($,'"\n>\n  <path d="').concat(X,'" />\n</svg>')},Y=function(e){var t=e.height,n=void 0===t?"50":t,o=e.style,a=void 0===o?{fill:"#444",stroke:"none"}:o,i=e.dataTestId;return Object(Z.jsxs)("svg",{"data-testid":i,height:n,style:a,viewBox:$,pointerEvents:"none",children:[Object(Z.jsx)("path",{fill:"url(#gradient-".concat(a.fill,")"),d:X,pointerEvents:"visiblepainted",cursor:"pointer"}),Object(Z.jsx)("defs",{children:Object(Z.jsxs)("linearGradient",{id:"gradient-".concat(a.fill),gradientTransform:"rotate(90)",children:[Object(Z.jsx)("stop",{offset:"00%",stopColor:"#FFFFFF",stopOpacity:"0"}),Object(Z.jsx)("stop",{offset:"100%",stopColor:a.fill,stopOpacity:"1"})]})})]})},ee="-5 -1 25 50",te="M 8 16 L 0 8 L 16 8 Z",ne=function(e){return"\nM ".concat(8-e," ").concat(32+e,"\na ").concat(e," ").concat(e,", 0, 0, 0, ").concat(2*e," 0\na ").concat(e," ").concat(e,", 0, 0, 0, ").concat(-2*e," 0\n")},oe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"stroke-width: 1";return'\n<svg xmlns="http://www.w3.org/2000/svg"\n  width="'.concat(e,'px"\n  height="').concat(e,'px"\n  style="').concat(t,'"\n  viewBox="').concat(ee,'"\n>\n  <path d="').concat(te,'" />\n  <path style="').concat(o,'" d="').concat(n&&ne(n)||"",'" />\n</svg>')},ae=function(e,t){return oe(e,t,0)},ie=n(501),re=n(505),ce=n(241),le=function(e){return"https://app.olmap.org/#/note/".concat(e)},se={main:2,yes:1,null:0,"":0,no:-1},ue=function(e){return e.workplace&&e.workplace.workplace_entrances.sort((function(e,t){return se[t.deliveries||"null"]-se[e.deliveries||"null"]})),e},de=function(){var e=Object(u.a)(s.a.mark((function e(t){var n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.prev=2,e.next=5,fetch("https://api.olmap.org/rest/osm_features/".concat(t,"/"));case 5:return n=e.sent,e.prev=6,e.next=9,n.json();case 9:if(o=e.sent,n.ok){e.next=12;break}return e.abrupt("return",{state:"failed",code:n.status,detail:o.detail});case 12:return e.abrupt("return",{state:"success",response:ue(o)});case 15:return e.prev=15,e.t0=e.catch(6),e.abrupt("return",{state:"failed",code:n.status,detail:e.t0});case 18:e.next=23;break;case 20:return e.prev=20,e.t1=e.catch(2),e.abrupt("return",{state:"failed",code:0,detail:e.t1});case 23:case"end":return e.stop()}}),e,null,[[2,20],[6,15]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e,t){if("success"!==(null===e||void 0===e?void 0:e.state)||!e.response.workplace)return{type:"FeatureCollection",features:[]};var n=[];return t.forEach((function(e,t){n.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:Object(d.a)(Object(d.a)({"@id":"http://www.openstreetmap.org/".concat(e.type,"/").concat(e.id)},e.tags),{},{"@label":Object(ce.romanize)(t+1)})})})),{type:"FeatureCollection",features:n}},fe=function(e){if("success"!==(null===e||void 0===e?void 0:e.state)||!e.response.workplace)return[[],{}];var t=e.response.workplace.workplace_entrances,n={};return[t.flatMap((function(e){return e.unloading_places.flatMap((function(t){var o=n[t.id],a=e.entrance_data.osm_feature;return o?(o.push(a),[]):(n[t.id]=[a],[t])}))})),n]},ge=function(e){return fe(e)[0]},be=function(e){var t=e.noteId,n=e.onClose;return Object(Z.jsx)(ie.a,{open:!!t,fullWidth:!0,PaperProps:{style:{height:"100%",overflow:"hidden"}},children:t&&Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsxs)(re.a,{children:["Note on OLMap",Object(Z.jsx)(v.a,{style:{position:"absolute",top:"8px",right:"8px"},onClick:n,children:Object(Z.jsx)(j.a,{})})]}),Object(Z.jsx)("div",{style:{height:"100%",borderTop:"1px solid rgba(0, 0, 0, 0.12)"},children:Object(Z.jsx)("iframe",{title:"OLMap note editor",src:le(t),style:{border:"none",padding:0,margin:0,width:"100%",height:"100%"}})})]})})},he=function(e){var t,n,o=e.onImageClick,a=e.olmapData,i="success"===(null===a||void 0===a?void 0:a.state)&&(null===a||void 0===a||null===(t=a.response)||void 0===t||null===(n=t.image_notes)||void 0===n?void 0:n.filter((function(e){return e.image})).slice(0,1).map((function(e){return Object(Z.jsx)("a",{href:le(e.id),onClick:o,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex"},children:Object(Z.jsx)("img",{style:{maxWidth:"100%",maxHeight:"150px"},src:e.image,alt:"A photo of the entrance"})},e.id)})));return Object(Z.jsx)("div",{style:{textAlign:"center"},children:i})},ve=function(e){var t=e.dataTestId,n=e.width,o=void 0===n?"40":n,a=e.height,i=void 0===a?"40":a,r=e.stroke,c=void 0===r?"#00afff":r,l=e.strokeWidth,s=void 0===l?"16":l;return Object(Z.jsxs)("svg",{"data-testid":t,width:o,height:i,stroke:c,strokeWidth:s,viewBox:"-100 -100 200 200",fill:"transparent",style:{position:"absolute"},children:[Object(Z.jsx)("circle",{cx:"0",cy:"0",r:"24"}),Object(Z.jsx)("circle",{cx:"0",cy:"0",r:"46"}),Object(Z.jsx)("circle",{cx:"0",cy:"0",r:"68"})]})},je=function(e){var t=e.dataTestId,n=e.onGeolocate,o=e.onGeolocateError,a=e.positionOptions,i=void 0===a?{enableHighAccuracy:!0,timeout:6e3}:a,r=e.onEnable,c=e.onDisable,l=e.enableOnMount,s=void 0===l||l,u=Object(g.useState)(null!=window.navigator.geolocation),d=Object(f.a)(u,1)[0],p=Object(g.useState)(null!=window.navigator.permissions),b=Object(f.a)(p,1)[0],h=Object(g.useState)(null),v=Object(f.a)(h,2),j=v[0],m=v[1],O=Object(g.useState)(null),x=Object(f.a)(O,2),y=x[0],w=x[1],k=Object(g.useState)(!1),C=Object(f.a)(k,2),_=C[0],E=C[1],P=function(e){d&&null==y&&(w(window.navigator.geolocation.watchPosition(n,o,i)),E(!0),null!=r&&r(e))},S=function(){d&&null!=y&&(window.navigator.geolocation.clearWatch(y),w(null),null!=c&&c())},M=function(){console.log("Geolocation is denied. Inform the user.")};Object(g.useEffect)((function(){d||console.log("Geolocation is not supported. Inform the user.")}),[d]),Object(g.useEffect)((function(){d&&b&&null==j&&b&&window.navigator.permissions.query({name:"geolocation"}).then((function(e){m(e.state),e.onchange=function(){m(this.state)}})).catch((function(e){console.error("Permissions API exists but querying it fails:",e)}))}),[]),Object(g.useEffect)((function(){"denied"===j&&(M(),S())}),[j]);var D=!b||null!=j,T=null!=y;Object(g.useEffect)((function(){!s||_||!d||T||b&&(null==j||"denied"===j)||P(!1)}),[s,_,d,T,b,j]);var N=null;if(d){var L=T?"Stop using my location":"Find my location",F=T?"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate mapboxgl-ctrl-geolocate-active":"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate";N=Object(Z.jsx)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group mapboxgl-ctrl-bottom-left",children:Object(Z.jsx)("button",{type:"button",className:F,"data-testid":t,"aria-label":L,"aria-pressed":T,onContextMenu:function(e){return e.preventDefault()},onClick:D?function(e){console.assert(d),console.assert(D),e.preventDefault(),T?S():b&&"denied"===j?M():P(!0)}:void 0,children:Object(Z.jsx)("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"})})})}return N},me=/^(https:\/\/w3id.org\/openstreetmap\/terms#|osm:)/,Oe=function(e,t,n){var o={"@id":e};return Object.entries(t||{}).forEach((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1];if((n.startsWith("https://w3id.org/openstreetmap/terms#")||n.startsWith("osm:"))&&"https://w3id.org/openstreetmap/terms#hasTag"!==n&&"osm:hasTag"!==n){var i=n.replace(me,""),r=a.replace(me,"");o[i]="NoAccess"===r?"no":"FreeAccess"===r?"yes":"OfficialAccess"===r?"official":"highway"===i&&"UnderConstruction"===r?"construction":"construction"===i&&"UnderConstruction"===r?"yes":r.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}})),null===n||void 0===n||n.forEach((function(e){var t=e.indexOf("="),n=e.substring(0,t),a=e.substring(t+1);o[n]=a})),o};function xe(e){var t=[],n=[],o=new Map,a=[];return e.legs[0].getSteps().forEach((function(i,r){var c,l;if(i.startLocation.id||i.stopLocation.id||1===r){var s=i.stopLocation;if("https://w3id.org/openstreetmap/terms#Steps"===(null===(c=e.context[i.through])||void 0===c?void 0:c.definedTags["https://w3id.org/openstreetmap/terms#highway"])){var u;if(!o.has(i.through)){var d=e.context[i.through],p=Oe(i.through,d.definedTags,d.freeformTags);o.set(i.through,[p,[]])}null===(u=o.get(i.through))||void 0===u||u[1].push([i.startLocation.longitude,i.startLocation.latitude],[i.stopLocation.longitude,i.stopLocation.latitude])}if(null===(l=s.definedTags)||void 0===l?void 0:l["https://w3id.org/openstreetmap/terms#barrier"]){var f=Oe(s.id,s.definedTags,s.freeformTags);n.push({type:s.id,id:s.id,lon:s.longitude,lat:s.latitude,tags:f})}t.push([i.startLocation.longitude,i.startLocation.latitude]),t.push([i.stopLocation.longitude,i.stopLocation.latitude])}else a.push([[i.startLocation.longitude,i.startLocation.latitude],[i.stopLocation.longitude,i.stopLocation.latitude]])})),{coordinates:t,obstacles:n,obstacleWays:Array.from(o.values()),imaginaryWays:a}}function ye(e,t,n,o,a,i){var r=[];return e&&r.push({type:"Feature",geometry:{type:"Point",coordinates:[e[1],e[0]]},properties:{"@color":a}}),t&&t.forEach((function(e){r.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{"@color":i}})})),n&&n.forEach((function(e){var t,n;r.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{"@color":"#00ffff","@label":(null===(t=e.tags)||void 0===t?void 0:t.ref)||(null===(n=e.tags)||void 0===n?void 0:n["addr:unit"]),"@opacity":0}})})),(null===o||void 0===o?void 0:o.coordinates)&&r.push({type:"Feature",geometry:{type:"LineString",coordinates:o.coordinates},properties:{"@color":"#000"}}),null===o||void 0===o||o.obstacleWays.forEach((function(e){var t=Object(f.a)(e,2),n=t[0],o=t[1];r.push({type:"Feature",geometry:{type:"LineString",coordinates:o},properties:Object(d.a)(Object(d.a)({},n),{},{"@color":"#dc0451","@opacity":1,"@interactive":!0})})})),(null===o||void 0===o?void 0:o.imaginaryWays)&&r.push({type:"Feature",geometry:{type:"MultiLineString",coordinates:o.imaginaryWays},properties:{"@color":"#000","@imaginary":!0}}),null===o||void 0===o||o.obstacles.forEach((function(e){r.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:Object(d.a)(Object(d.a)({},e.tags),{},{"@color":"#dc0451","@label":"!"})})})),{type:"FeatureCollection",features:r}}function we(e,t){return ke.apply(this,arguments)}function ke(){return(ke=Object(u.a)(s.a.mark((function e(t,o){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4),n.e(2)]).then(n.bind(null,520));case 2:a=e.sent,i=a.Planner,t.forEach((function(e){var t=Object(f.a)(e,3),n=t[0],a=t[1],r=t[2],c=void 0===r?"delivery-walking":r,l=new i;l.setProfileID("".concat("https","://").concat("","/delivery.json")).query({from:{latitude:n[0],longitude:n[1]},to:{latitude:a.lat,longitude:a.lon}}).take(1).on("data",function(){var e=Object(u.a)(s.a.mark((function e(t){var i,r,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.completePath(t);case 2:i=e.sent,console.log("Plan",i,"from",n,"to",a),r=xe(i),u=ye(n,[a],void 0,r,"delivery-car"===c?"#000000":"#00afff","delivery-car"===c?"#00afff":"#64be14"),o(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=(null===(c=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_OVERPASS_INTERPRETER)||void 0===c?void 0:c.replace(/\?$/,""))||"https://overpass.fvh.io/api/interpreter",_e=function(e){var t,n,o=new URL(Ce);return o.searchParams.append("data",(t=e.lat,n=e.lon,"\n  [out:json][timeout:25];\n  (\n    relation(around:10, ".concat(t,", ").concat(n,")[building];\n    way(r);\n    way(around:10, ").concat(t,", ").concat(n,')[building];\n  )->.b;\n  (\n    relation(around.b:10)["building:part"];\n    way(r);\n    way(around.b:10)["building:part"];\n  )->.p;\n  // gather results\n  (\n    node(w.b)[entrance];\n    node(w.p)[entrance];\n  );\n  // print results\n  out body;\n  >;\n  out skel qt;\n'))),fetch(o.toString()).then((function(e){return e.json().then((function(e){return e.elements.filter((function(e){return"node"===e.type&&"lat"in e&&null!=e.lat&&"lon"in e&&null!=e.lon&&e.tags&&e.tags.entrance}))}))}))},Ee=function(e,t,n){var o=n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n");return"\n  [out:json][timeout:25];\n  (\n    way(around:100, ".concat(e,", ").concat(t,')["highway"][name="').concat(o,'"];\n  );\n  // print results as id and geometry for each way in qt (non-sorted) order\n  out ids geom qt;')},Pe=function(){var e=Object(u.a)(s.a.mark((function e(t,n){var o,a,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new URL(Ce)).searchParams.append("data",Ee(t.lat,t.lon,n)),e.next=4,fetch(o.toString());case 4:return a=e.sent,e.next=7,a.json();case 7:return i=e.sent,r=i.elements.map((function(e){return e.geometry.map((function(e){var t=e.lat;return[e.lon,t]}))})),e.abrupt("return",{type:"MultiLineString",coordinates:r});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Se=function(e){return"\n  [out:json][timeout:25];\n  node(id:".concat(e.join(","),");\n  out;\n")},Me=function(){var e=Object(u.a)(s.a.mark((function e(t){var n,o,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new URL(Ce),t.length){e.next=3;break}return e.abrupt("return",[]);case 3:return n.searchParams.append("data",Se(t)),e.next=6,fetch(n.toString());case 6:return o=e.sent,e.next=9,o.json();case 9:return a=e.sent,e.abrupt("return",a.elements);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),De=function(e){var t,n;return{width:null===e||void 0===e||null===(t=e.getContainer())||void 0===t?void 0:t.clientWidth,height:null===e||void 0===e||null===(n=e.getContainer())||void 0===n?void 0:n.clientHeight}},Te=function(e){e.some((function(e){return["staircase","main"].includes(e.properties.entrance)}))&&e.forEach((function(e){["staircase","main"].includes(e.properties.entrance)||(e.properties["@secondary"]=!0)}))},Ne=function(e,t,n,o,a){if(!e["osm:hasNodes"])return[];if("string"===typeof e["osm:hasNodes"])return[];var i=e["osm:hasNodes"];if(i.length<4)return console.log("not an area",e["@id"]),[];i[0]!==i[i.length-1]&&console.log("unclosed",e["@id"]);var r=null,c=[];return i.forEach((function(i,l,s){var u=n[i];if(u){null===r&&(r=Object(w.booleanClockwise)(Object(w.lineString)(s.map((function(e){return t[e]})))));var p=t[i],f=0===l?t[s[s.length-2]]:t[s[l-1]],g=l===s.length-1?t[s[1]]:t[s[l+1]],b=Object(w.bearing)(p,f),h=Object(w.bearing)(p,g),v=Math.abs(b-h)/2+Math.min(b,h),j=b>h?v+270:v+90,m=r!==!!o?j:j+180,O=u.properties["@entrance-label"],x=u.properties["@house-label"];if(!u.properties["addr:housenumber"]&&!u.properties.ref&&!u.properties["addr:unit"]){var y=Le(a||e);O=O||y.entrance}u.properties=Object(d.a)(Object(d.a)({},u.properties),{},{"@offset":[.2*Math.cos(m/180*Math.PI),.2*Math.sin(m/180*Math.PI)],"@rotate":((m-90)%360+360)%360,"@entrance-label":O,"@house-label":x}),c.push(u)}})),c},Le=function(e){var t,n,o,a,i,r,c=(null===(t=e["osm:hasTag"])||void 0===t||null===(n=t.find((function(e){return e.startsWith("addr:housenumber=")})))||void 0===n?void 0:n.substring(17))||"",l=null===(o=e["osm:hasTag"])||void 0===o||null===(a=o.find((function(e){return e.startsWith("ref=")})))||void 0===a?void 0:a.substring(4),s=null===(i=e["osm:hasTag"])||void 0===i||null===(r=i.find((function(e){return e.startsWith("addr:unit=")})))||void 0===r?void 0:r.substring(10),u=l||s||"";return{house:c.replace(/ /g,"\u2009"),entrance:u.replace(/ /g,"\u2009")}},Fe=function(e){for(var t={},n={},o={},a={},i=0;i<e["@graph"].length;i++){var r=e["@graph"][i];if("osm:Relation"===r["@type"])a[r["@id"]]=r;else if("osm:Way"===r["@type"])o[r["@id"]]=r;else if(r["geo:lat"]&&r["geo:long"]){var c,l=[r["geo:long"],r["geo:lat"]];if(n[r["@id"]]=l,null===(c=r["osm:hasTag"])||void 0===c?void 0:c.find((function(e){return e.startsWith("entrance=")}))){var s=r["@id"],u=Oe(s,r,r["osm:hasTag"]),p=Le(r),f={type:"Feature",geometry:{type:"Point",coordinates:l},properties:Object(d.a)(Object(d.a)({},u),{},{"@entrance-label":p.entrance,"@house-label":p.house})};t[s]=f}}}return function(e,t,n,o){Object.values(e).filter((function(e){var t;return null===(t=e["osm:hasTag"])||void 0===t?void 0:t.find((function(e){return e.startsWith("building=")||e.startsWith("building:part=")}))})).forEach((function(e){var a=e["osm:hasMembers"].flatMap((function(a){var i=t[a["@id"]];return i?Ne(i,n,o,"inner"===a.role,e):[]}));Te(a)}))}(a,o,n,t),function(e,t,n){Object.values(e).filter((function(e){var t;return null===(t=e["osm:hasTag"])||void 0===t?void 0:t.find((function(e){return e.startsWith("building=")||e.startsWith("building:part=")}))})).forEach((function(e){Te(Ne(e,t,n))}))}(o,n,t),{type:"FeatureCollection",features:Object.values(t)}},We=256,Ae=12756274*Math.PI;function Ie(e,t,n,o){for(var a=function(e){var t=Ae*e[0]/360,n=Math.sin(e[1]*Math.PI/180),o=Ae*Math.log((1+n)/(1-n))/(4*Math.PI);return[Ae/2+t,Ae-(Ae/2+o)]}(n),i=[a[0]*We*Math.pow(2,o)/Ae,a[1]*We*Math.pow(2,o)/Ae],r=[Math.floor((i[0]-e/2)/We),Math.floor((i[1]-t/2)/We),Math.ceil((i[0]+e/2)/We),Math.ceil((i[1]+t/2)/We)],c=[],l=r[0];l<r[2];++l)for(var s=r[1];s<r[3];++s){var u=l*We-i[0]+e/2,d=s*We-i[1]+t/2;c.push({x:l,y:s,zoom:o,px:u,py:d})}return c}n(326),n(327);var Re=n(509),ze=n(512),Ue=n(506),Ge=n(513),Be=n(514),Ke=n(515),qe=n(524),He=n(516),Je=n(517),Ve=(n(328),n(510)),Ze=n(511),$e=function(e){var t=e.open,n=e.collapsed,o=e.venueOlmapData,a=e.onClose,i=e.onEntranceSelected,r=e.onUnloadingPlaceSelected,c=e.onCollapsingToggled;if("success"!==(null===o||void 0===o?void 0:o.state)||!o.response.workplace)return null;var l=o.response.image_notes,s=o.response.workplace,u=s.workplace_entrances,p=l.filter((function(e){return e.image&&e.tags.find((function(e){return"Workplace"===e}))})),f=s.image_note.image?[s.image_note]:p,g=ge(o);return Object(Z.jsxs)(Re.a,{open:t,anchor:"bottom",variant:"persistent",elevation:8,PaperProps:{style:{maxHeight:"45%",width:"100%",maxWidth:"600px",left:"50%",transform:"translateX(-50%)"},elevation:8},children:[Object(Z.jsxs)(re.a,{children:[Object(Z.jsx)(v.a,{style:{position:"absolute",top:"8px",left:"8px"},onClick:function(){return c()},children:n?Object(Z.jsx)(Ve.a,{}):Object(Z.jsx)(Ze.a,{})}),s.as_osm_tags.name,Object(Z.jsx)(v.a,{style:{position:"absolute",top:"8px",right:"8px"},onClick:a,children:Object(Z.jsx)(j.a,{})})]}),Object(Z.jsxs)(ze.a,{style:{display:n?"none":"block",overflow:"auto"},children:[Object(Z.jsx)(he,{onImageClick:function(){},olmapData:{state:"success",response:Object(d.a)(Object(d.a)({},o.response),{},{image_notes:f})}}),Object(Z.jsx)(Ue.a,{variant:"body2",color:"textSecondary",component:"p",children:s.delivery_instructions}),u.map((function(e,t){return Object(Z.jsxs)(Ge.a,{style:{marginTop:"1em"},variant:"outlined",children:[Object(Z.jsx)(Be.a,{component:"img",image:e.image_note.image,style:{width:"50%",height:"auto",float:"right"}}),Object(Z.jsx)(Ke.a,{avatar:Object(Z.jsx)(qe.a,{style:{background:"#af8dbc",color:"#af8dbc",textShadow:"\n0      -1px 0.5px white,\n1px    -1px 0.5px white,\n1px    0    0.5px white,\n1px    1px  0.5px white,\n0      1px  0.5px white,\n-1px   1px  0.5px white,\n-1px   0    0.5px white,\n-1px   -1px 0.5px white,\n2px    -0.5px 0.5px white,\n2px    0.5px  0.5px white,\n-2px   -0.5px 0.5px white,\n-2px   0.5px  0.5px white,\n-0.5px 2px 0.5px white,\n0.5px  2px 0.5px white,\n-0.5px -2px 0.5px white,\n0.5px  -2px 0.5px white,\n-1.5px    1.5px  0.5px white,\n1.5px    -1.5px  0.5px white,\n-1.5px -1.5px 0.5px white,\n1.5px    1.5px  0.5px white,\n2px    0px 0.5px white,\n0px    2px  0.5px white,\n-2px   0px 0.5px white,\n0px    -2px  0.5px white",font:'30px "Noto Sans"'},children:Object(Z.jsx)("span",{children:Object(ce.romanize)(t+1)})}),title:"".concat([e.description,e.delivery_types.join("; ")].filter((function(e){return e})).join(": ")),subheader:e.delivery_hours||s.delivery_hours,titleTypographyProps:{style:{background:"rgba(255,255,255,0.5)"}},subheaderTypographyProps:{style:{background:"rgba(255,255,255,0.5)"}}}),Object(Z.jsx)(He.a,{children:Object(Z.jsx)(Ue.a,{variant:"body2",color:"textSecondary",component:"p",children:e.delivery_instructions})}),Object(Z.jsx)(Je.a,{children:Object(Z.jsx)(h.a,{variant:"contained",size:"small",style:{backgroundColor:"#64be14",color:"#fff"},type:"button","aria-label":"Set destination",onClick:function(){return i(e.entrance_data.osm_feature)},children:"Destination"})})]},e.id)})),g.map((function(e){return Object(Z.jsxs)(Ge.a,{style:{marginTop:"1em"},variant:"outlined",children:[Object(Z.jsx)(Be.a,{component:"img",image:e.image_note.image,style:{width:"50%",height:"auto",float:"right"}}),Object(Z.jsx)(Ke.a,{title:e.as_osm_tags["parking:condition"],subheader:e.opening_hours}),Object(Z.jsx)(He.a,{children:Object(Z.jsx)(Ue.a,{variant:"body2",color:"textSecondary",component:"p",children:e.description})}),Object(Z.jsx)(Je.a,{children:Object(Z.jsx)(h.a,{variant:"contained",size:"small",style:{backgroundColor:"#00afff",color:"#fff"},type:"button","aria-label":"Set origin",onClick:function(){return r(e)},children:"Origin"})})]},e.id)}))]})]})},Xe=200,Qe=function(e){return{id:-1,type:"node",lat:e[0],lon:e[1]}},Ye=function(e){return[e.lat,e.lon]},et=function(e){var t,n=null===(t=e.properties)||void 0===t?void 0:t["@id"].split("/").reverse(),o=Object(f.a)(n,2),a=o[0],i=o[1];return{id:parseInt(a,10),type:i,lat:e.geometry.coordinates[1],lon:e.geometry.coordinates[0],tags:e.properties||void 0}},tt={type:"FeatureCollection",features:[]},nt={entrances:[],route:ye(),highlights:tt,viewport:{latitude:60.17,longitude:24.941,zoom:15,bearing:0,pitch:0},isOriginExplicit:!1,isGeolocating:!1,geolocationPosition:null,popupCoordinates:null,routableTiles:new Map,venueDialogOpen:!1,venueDialogCollapsed:!1,venueFeatures:tt},ot=[60.17066815612902,24.941510260105133],at=function(e){return{url:e.replace("https://static.hsldev.com/mapfonts/Klokantech Noto Sans","https://fonts.openmaptiles.org/Klokantech Noto Sans")}},it=function(e,t){return Object(w.distance)([e[1],e[0]],[t[1],t[0]],{units:"meters"})},rt=function(e){if(e){var t=e.split(",");if(2===t.length&&t[0].length&&t[1].length){var n=t.map(Number),o=Object(f.a)(n,2),a=o[0],i=o[1];if(!Number.isNaN(a)&&i>-90&&i<90)return[a,i]}}},ct=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=new y.a(e),a=t.filter((function(e){return e}));if(!a.length)return e;var i=Math.min.apply(Math,Object(p.a)(a.map((function(e){return e[1]})))),r=Math.max.apply(Math,Object(p.a)(a.map((function(e){return e[1]})))),c=Math.min.apply(Math,Object(p.a)(a.map((function(e){return e[0]})))),l=Math.max.apply(Math,Object(p.a)(a.map((function(e){return e[0]})))),s=20,u=50,d=40,f=n*e.height,g=5,b=o.fitBounds([[i,c],[r,l]],{padding:{top:s+d+u,bottom:s+f+g,left:s+u/2,right:s+u/2},maxZoom:n?void 0:17});return b};t.default=function(){var e,t,n,o,a,i,r,c,l,y,C,_,E=Object(g.useRef)(null),P=Object(g.useRef)(null);Object(g.useEffect)((function(){if(E.current){var e=E.current.getMap();null===e||void 0===e||e.on("styleimagemissing",(function(t){var n=t.id;if(null===n||void 0===n?void 0:n.startsWith("icon-svg-")){var o,a=n.split("-"),i=Object(f.a)(a,6),r=i[2],c=i[3],l=i[4],s=i[5];if("pin"===r)o=Q;else if("triangle"===r)o=ae;else{if("triangleDot"!==r)return;o=oe}var u=o(c,"fill: ".concat(l,"; stroke: ").concat(s));!function(e,t,n,o){var a=window.devicePixelRatio,i=document.createElement("canvas");i.width=a*o,i.height=a*o;var r=i.getContext("2d"),c=new Image(o,o),l="data:image/svg+xml,".concat(encodeURIComponent(n));c.onload=function(){if(!r)throw Error("canvas.getContext failed");r.drawImage(c,0,0,a*o,a*o),e.addImage(t,r.getImageData(0,0,a*o,a*o),{pixelRatio:a})},c.src=l}(e,n,u,c)}}))}}),[E]);var S=Object(b.e)({path:"/route/:from?/:to?"}),M=Object(g.useState)(nt),D=Object(f.a)(M,2),T=D[0],N=D[1],L=function(e,t,n){var o;return ct(Object(d.a)(Object(d.a)({},e),De(null===(o=E.current)||void 0===o?void 0:o.getMap())),t,n)};Object(g.useEffect)((function(){if(E.current&&T.viewport.zoom&&!(T.viewport.zoom<12)){var e=De(E.current.getMap()),t=e.width,n=e.height,o=Math.pow(2,13-T.viewport.zoom),a=Ie(o*t,o*n,[T.viewport.longitude,T.viewport.latitude],14),i=new Map;a.forEach((function(e){var t=e.zoom,n=e.x,o=e.y,a="".concat(t,"/").concat(n,"/").concat(o);i.set(a,T.routableTiles.get(a)||null)})),N((function(e){return Object(d.a)(Object(d.a)({},e),{},{routableTiles:i})})),a.map(function(){var e=Object(u.a)(s.a.mark((function e(t){var n,o,a,r,c,l,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.zoom,o=t.x,a=t.y,r="".concat(n,"/").concat(o,"/").concat(a),null===i.get(r)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,fetch("https://tile.olmap.org/building-tiles/".concat(n,"/").concat(o,"/").concat(a));case 6:return c=e.sent,e.next=9,c.json();case 9:l=e.sent,u=Fe(l),N((function(e){if(null!==e.routableTiles.get(r))return e;var t=new Map(e.routableTiles);return t.set(r,u),Object(d.a)(Object(d.a)({},e),{},{routableTiles:t})}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),[E.current,T.viewport]),Object(g.useEffect)((function(){if(E.current){var e=De(E.current.getMap()),t=e.width,n=e.height;if(S&&null!=t&&t>0&&null!=n&&n>0){var o=rt(S.params.from),a=rt(S.params.to),i=Object(d.a)(Object(d.a)({},T.viewport),{},{width:t,height:n}),r=ct(i,[o,a]);N((function(e){return Object(d.a)(Object(d.a)({},e),{},{origin:o,isOriginExplicit:null!=o,destination:a&&Qe(a),viewport:Object(d.a)(Object(d.a)({},e.viewport),r)})}))}}}),[E]);var F=Object(b.d)(),W=Object(O.b)(),A=null===W||void 0===W?void 0:W.enqueueSnackbar,I=null===W||void 0===W?void 0:W.closeSnackbar;Object(g.useEffect)((function(){var e=T.destination&&[T.destination.lat,T.destination.lon],t="/route/".concat(T.origin,"/").concat(e,"/");if(F.location.pathname!==t){var n=t;if(/utm_source=/.exec(F.location.search)){var o=new URLSearchParams(F.location.search).get("utm_source");if(null!==o){var a=new URLSearchParams({utm_source:o});n="".concat(t,"?").concat(a)}}F.replace(n)}}),[F,T.origin,T.destination]),Object(g.useEffect)((function(){Object(u.a)(s.a.mark((function e(){var t,n,o,a,i,r,c,l,u,p,f,g,b,h,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T.destination){e.next=2;break}return e.abrupt("return");case 2:if(n=[],o=T.venueOlmapData,a=T.venueFeatures,(null===(t=T.entrances)||void 0===t?void 0:t.find((function(e){var t;return e.id===(null===(t=T.destination)||void 0===t?void 0:t.id)})))&&(n=T.entrances.slice()),e.prev=5,T.destination.id!==(null===(i=T.venue)||void 0===i?void 0:i.id)||"success"!==(null===(r=o)||void 0===r?void 0:r.state)||(null===(c=o.response.workplace)||void 0===c?void 0:c.osm_feature)!==T.destination.id){e.next=10;break}n=a.features.map((function(e){return et(e)})),e.next=22;break;case 10:if(T.destination.id!==(null===(l=T.venue)||void 0===l?void 0:l.id)){e.next=22;break}return e.next=13,de(T.venue.id);case 13:if(o=e.sent,a=tt,"success"!==(null===(u=o)||void 0===u?void 0:u.state)){e.next=22;break}return g=null===(p=o.response.workplace)||void 0===p?void 0:p.workplace_entrances,b=null===g||void 0===g?void 0:g.map((function(e){return e.entrance_data.osm_feature})),e.next=20,Me(b||[]);case 20:n=e.sent,(null===(f=o.response.workplace)||void 0===f?void 0:f.workplace_entrances)&&(h=[],v=[],null===g||void 0===g||g.forEach((function(e){var t=n.find((function(t){return t.id===e.entrance_data.osm_feature}));t&&(h.push(e),v.push(t))})),o.response.workplace.workplace_entrances=h,a=pe(o,v));case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(5),console.error("Error while fetching venue entrances:",e.t0);case 27:if(e.prev=27,n.length){e.next=32;break}return e.next=31,_e(T.destination);case 31:n=e.sent;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(27),console.error("Error while fetching building entrances:",e.t1);case 37:N((function(e){if(!T.destination)return e;if(e.destination!==T.destination)return e;var t=n.length?n:[T.destination];return Object(d.a)(Object(d.a)({},e),{},{entrances:t,venueOlmapData:o,venueFeatures:a})}));case 38:case"end":return e.stop()}}),e,null,[[5,24],[27,34]])})))().catch((function(e){console.error("Error while handling entrances:",e)}))}),[T.destination,T.venue]),Object(g.useEffect)((function(){Object(u.a)(s.a.mark((function e(){var t,n,o,a,i,r,c,l,u,p,g,b,m,O,x,y,k,C,_,E,P,S,M;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T.snackbar&&I(T.snackbar),T.destination&&T.entrances){e.next=3;break}return e.abrupt("return");case 3:if(a=T.origin,i=[],T.entrances.forEach((function(e){T.destination&&T.destination.type===e.type&&T.destination.id===e.id&&(i=[e])})),i.length||(i=T.entrances),N((function(e){return Object(d.a)(Object(d.a)({},e),{},{route:ye()})})),r=[],T.destination.id===(null===(t=T.venue)||void 0===t?void 0:t.id)&&(r=ge(T.venueOlmapData)),!(c="success"===(null===(n=T.venueOlmapData)||void 0===n?void 0:n.state)&&(null===(o=T.venueOlmapData.response.workplace)||void 0===o?void 0:o.workplace_entrances.find((function(e){var t;return e.entrance_data.osm_feature===(null===(t=T.destination)||void 0===t?void 0:t.id)})))||void 0)||!c.unloading_places.length){e.next=15;break}r=c.unloading_places,e.next=27;break;case 15:if(!r.length){e.next=19;break}T.unloadingPlace&&(l=r.find((function(e){var t;return e.id===(null===(t=T.unloadingPlace)||void 0===t?void 0:t.id)})))&&(r=[l]),e.next=27;break;case 19:if(T.origin&&!(it(T.origin,Ye(T.destination))>=Xe)){e.next=27;break}if((null===(u=T.destination.tags)||void 0===u?void 0:u["addr:street"])?(p=T.destination,g=null===(b=T.destination.tags)||void 0===b?void 0:b["addr:street"]):(O=i,x=Object(f.a)(O,1),p=x[0],g=null===(m=p.tags)||void 0===m?void 0:m["addr:street"]),!g){e.next=27;break}return e.next=24,Pe(p,g);case 24:y=e.sent,k=Object(w.nearestPointOnLine)(y,[p.lon,p.lat]).geometry.coordinates,a=[k[1],k[0]];case 27:if(a||r.length){e.next=29;break}return e.abrupt("return");case 29:if(!(!r.length&&a&&a===T.origin&&it(a,Ye(T.destination))>=Xe)){e.next=34;break}return C=T.isOriginExplicit?"Origin is too far for showing routes.":"Routes show when distance is shorter.",_=A(C,{variant:"info",persist:!0,anchorOrigin:{vertical:"bottom",horizontal:"center"},action:Object(Z.jsxs)(Z.Fragment,{children:[T.isOriginExplicit&&Object(Z.jsx)(h.a,{color:"inherit",onClick:function(){N((function(e){return Object(d.a)(Object(d.a)({},e),{},{origin:e.geolocationPosition||void 0,isOriginExplicit:!1,viewport:L(e.viewport,[e.destination&&Ye(e.destination)])})}))},children:"Undo origin"}),Object(Z.jsx)(h.a,{color:"inherit",onClick:function(){N((function(e){return Object(d.a)(Object(d.a)({},e),{},{destination:void 0,entrances:[],viewport:L(e.viewport,[e.origin])})}))},children:"Undo destination"}),Object(Z.jsx)(h.a,{color:"inherit",target:"_blank",rel:"noreferrer",href:"https://www.google.com/maps/dir/?api=1&origin=".concat(T.origin[0],",").concat(T.origin[1],"&destination=").concat(T.destination.lat,",").concat(T.destination.lon,"&travelmode=driving"),children:"Google Maps"}),Object(Z.jsx)(v.a,{"aria-label":"close",onClick:function(){return I(_)},children:Object(Z.jsx)(j.a,{})})]})}),N((function(e){return Object(d.a)(Object(d.a)({},e),{},{snackbar:_})})),e.abrupt("return");case 34:return E=[],r.length?T.destination.id===(null===(P=T.venue)||void 0===P?void 0:P.id)?(s=T.venueOlmapData,S=fe(s)[1],r.forEach((function(e){S[e.id].forEach((function(t){var n,o,a=null===(n=T.entrances)||void 0===n?void 0:n.find((function(e){return e.id===t}));a&&E.push([[Number(e.image_note.lat),Number(e.image_note.lon)],a,"delivery-walking"]),null===(o=e.access_points)||void 0===o||o.forEach((function(t){E.push([[Number(t.lat),Number(t.lon)],Qe([Number(e.image_note.lat)+1e-6,Number(e.image_note.lon)+1e-6]),"delivery-car"])}))}))}))):null===c||void 0===c||null===(M=c.unloading_places)||void 0===M||M.forEach((function(e){var t;T.destination&&E.push([[Number(e.image_note.lat),Number(e.image_note.lon)],T.destination,"delivery-walking"]),null===(t=e.access_points)||void 0===t||t.forEach((function(t){E.push([[Number(t.lat),Number(t.lon)],Qe([Number(e.image_note.lat)+1e-6,Number(e.image_note.lon)+1e-6]),"delivery-car"])}))})):i.forEach((function(e){a&&E.push([a,e])})),e.next=38,we(E,(function(e){N((function(t){if(T.origin!==t.origin||T.entrances!==t.entrances||T.destination!==t.destination)return t;var n=Object(d.a)(Object(d.a)({},e),{},{features:e.features.concat(t.route.features)});return Object(d.a)(Object(d.a)({},t),{},{route:n})}))}));case 38:case"end":return e.stop()}var s}),e)})))().catch((function(e){console.error("Error while starting route planning:",e)}))}),[T.origin,T.entrances,T.unloadingPlace]),Object(g.useEffect)((function(){Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T.popupCoordinates){e.next=2;break}return e.abrupt("return");case 2:return N((function(e){return e.popupCoordinates!==T.popupCoordinates?e:Object(d.a)(Object(d.a)({},e),{},{olmapData:{state:"loading"}})})),e.next=5,de(T.popupCoordinates.id);case 5:t=e.sent,N((function(e){return e.popupCoordinates!==T.popupCoordinates?e:Object(d.a)(Object(d.a)({},e),{},{olmapData:t})}));case 7:case"end":return e.stop()}}),e)})))().catch((function(e){console.error("Error while fetching OLMap notes:",e)}))}),[T.popupCoordinates]),Object(g.useEffect)((function(){var e;"success"===(null===(e=T.venueOlmapData)||void 0===e?void 0:e.state)&&T.venueOlmapData.response.workplace&&N((function(e){var t,n=T.destination&&Ye(T.destination),o=e.origin&&n&&it(e.origin,n)<Xe?[e.origin,n]:[n],a=(null===(t=T.entrances)||void 0===t?void 0:t.map(Ye))||[],i=L(e.viewport,[].concat(o,Object(p.a)(a)),.5);return Object(d.a)(Object(d.a)({},e),{},{viewport:i})}))}),[T.venueOlmapData]);var K=function(e){var t,n=null===(t=E.current)||void 0===t?void 0:t.getMap().queryRenderedFeatures(e.point)[0];N((function(t){var o={type:"FeatureCollection",features:[]},a=Qe([e.lngLat.lat,e.lngLat.lng]);if(null===n||void 0===n?void 0:n.properties.entrance){var i=et(n);return Object(d.a)(Object(d.a)({},t),{},{popupCoordinates:i,highlights:o})}if((null===n||void 0===n?void 0:n.properties.barrier)||"steps"===(null===n||void 0===n?void 0:n.properties.highway)){var r=n.properties["@id"].split("/").reverse()[0],c="Point"===n.geometry.type?n.geometry.coordinates:Object(w.nearestPointOnLine)(n,e.lngLat.toArray()).geometry.coordinates,l=Object(f.a)(c,2),s=l[0],u=l[1];return Object(d.a)(Object(d.a)({},t),{},{popupCoordinates:{id:r,type:n.properties["@type"],lat:u,lon:s,tags:n.properties},highlights:o})}return null!=t.popupCoordinates?Object(d.a)(Object(d.a)({},t),{},{popupCoordinates:null,highlights:o}):"building"===(null===n||void 0===n?void 0:n.sourceLayer)?Object(d.a)(Object(d.a)({},t),{},{popupCoordinates:a,highlights:n.toJSON()}):Object(d.a)(Object(d.a)({},t),{},{popupCoordinates:a,highlights:o})}))},q=function(e){var t,n;return"success"===(null===e||void 0===e?void 0:e.state)&&(null===(t=e.response.image_notes)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id)},H=function(e){var t=q(T.olmapData);t&&(N((function(e){return Object(d.a)(Object(d.a)({},e),{},{editingNote:t})})),e.preventDefault())};return Object(Z.jsxs)("div",{"data-testid":"app",className:"App",children:[Object(Z.jsx)("header",{className:"App-header",children:Object(Z.jsx)("h2",{children:"Gatesolve"})}),Object(Z.jsx)("div",{className:"App-shadow"}),Object(Z.jsx)(k.ReactAutosuggestGeocoder,{ref:P,url:"https://api.digitransit.fi/geocoding/v1",sources:"oa,osm,nlsfi",highlightFirstSuggestion:!0,inputProps:{placeholder:"Destination name or address"},center:{latitude:(null===(e=T.geolocationPosition)||void 0===e?void 0:e[0])||(null===(t=T.origin)||void 0===t?void 0:t[0])||(null===(n=T.destination)||void 0===n?void 0:n.lat)||ot[0],longitude:(null===(o=T.geolocationPosition)||void 0===o?void 0:o[1])||(null===(a=T.origin)||void 0===a?void 0:a[1])||(null===(i=T.destination)||void 0===i?void 0:i.lon)||ot[1]},onSuggestionSelected:function(e,t){var n=t.suggestion;setTimeout((function(){P.current.blur()}));var o=[n.geometry.coordinates[1],n.geometry.coordinates[0]],a=n.properties.source_id.split(":"),i=Object(f.a)(a,2),r=i[0],c=i[1];N((function(e){var t=e.origin&&it(e.origin,o)<Xe?[e.origin,o]:[o],a=L(e.viewport,t),i={lat:o[0],lon:o[1],type:r,id:Number(c),tags:{"addr:street":n.properties.street}};return Object(d.a)(Object(d.a)({},e),{},{origin:e.origin,destination:i,entrances:[],venue:i,venueDialogOpen:!0,venueDialogCollapsed:!1,venueOlmapData:void 0,viewport:Object(d.a)(Object(d.a)({},e.viewport),a),venueFeatures:tt,unloadingPlace:void 0})}))}}),Object(Z.jsxs)(x.e,Object(d.a)(Object(d.a)({ref:E},T.viewport),{},{style:{width:"100%",height:"90%"},mapStyle:"https://raw.githubusercontent.com/HSLdevcom/hsl-map-style/master/simple-style.json",dragRotate:!1,transformRequest:at,onViewportChange:function(e){N((function(t){return Object(d.a)(Object(d.a)({},t),{},{viewport:e})}))},onHover:function(e){var t,n=null===(t=e.features)||void 0===t?void 0:t[0],o=(null===n||void 0===n?void 0:n.properties.entrance)?"pointer":"grab",a=document.querySelector(".overlays");a&&(a.style.cursor=o)},onClick:K,onContextmenu:K,children:[Object(Z.jsx)(je,{dataTestId:"geolocate-control",enableOnMount:!0,onEnable:function(e){N((function(t){return Object(d.a)(Object(d.a)({},t),{},{isOriginExplicit:!e&&t.isOriginExplicit,isGeolocating:!0})}))},onDisable:function(){N((function(e){return Object(d.a)(Object(d.a)({},e),{},{isGeolocating:!1,geolocationPosition:null})}))},onGeolocate:function(e){return N((function(t){if(t.isGeolocating){var n=null==t.geolocationPosition,o=[e.coords.latitude,e.coords.longitude],a=n&&!t.isOriginExplicit?L(t.viewport,[o,t.destination&&Ye(t.destination)]):t.viewport,i=Object(d.a)(Object(d.a)({},t),{},{geolocationPosition:o,viewport:a});return!t.isOriginExplicit&&(null==t.origin||it(t.origin,o)>20)?Object(d.a)(Object(d.a)({},i),{},{origin:o}):i}return t}))}}),null!=T.geolocationPosition&&Object(Z.jsx)(x.b,{offset:[-20,-20],longitude:T.geolocationPosition[1],latitude:T.geolocationPosition[0],children:Object(Z.jsx)(ve,{dataTestId:"user-marker"})}),Array.from(T.routableTiles.entries(),(function(e){var t=Object(f.a)(e,2),n=t[0],o=t[1];return o&&Object(Z.jsx)(x.d,{id:"source-".concat(n),type:"geojson",data:o,children:J.map((function(e){return Object(g.createElement)(x.a,Object(d.a)(Object(d.a)({},e),{},{key:"".concat(e.id,"-").concat(n),id:"".concat(e.id,"-").concat(n),source:"source-".concat(n)}))}))},n)})),Object(Z.jsx)(x.d,{id:"highlights",type:"geojson",data:T.highlights,children:Object(Z.jsx)(x.a,Object(d.a)(Object(d.a)({},B),{},{source:"highlights"}))}),Object(Z.jsx)(x.d,{id:"venue",type:"geojson",data:T.venueFeatures,children:R.map((function(e){return Object(g.createElement)(x.a,Object(d.a)(Object(d.a)({},e),{},{key:e.id,source:"venue"}))}))}),Object(Z.jsxs)(x.d,{id:"route",type:"geojson",data:T.route,children:[z.map((function(e){return Object(g.createElement)(x.a,Object(d.a)(Object(d.a)({},e),{},{key:e.id,source:"route",before:"building-highlight"}))})),Object(Z.jsx)(x.a,Object(d.a)(Object(d.a)({},U),{},{source:"route"})),Object(Z.jsx)(x.a,Object(d.a)(Object(d.a)({},G),{},{source:"route"})),Object(Z.jsx)(x.a,Object(d.a)(Object(d.a)({},V),{},{source:"route"}))]}),T.origin&&Object(Z.jsx)(x.b,{className:"PinMarker",draggable:!0,offset:[0,-22.5],onDragEnd:function(e){N((function(t){return Object(d.a)(Object(d.a)({},t),{},{origin:[e.lat,e.lng],isOriginExplicit:!0})}))},longitude:T.origin[1],latitude:T.origin[0],children:Object(Z.jsx)(Y,{dataTestId:"origin",style:{fill:"#00afff",stroke:"#fff"}})}),T.destination&&Object(Z.jsx)(x.b,{className:"PinMarker",draggable:!0,offset:[0,-22.5],onDragEnd:function(e){P.current.clear(),N((function(t){return Object(d.a)(Object(d.a)({},t),{},{destination:Qe([e.lat,e.lng])})}))},longitude:T.destination.lon,latitude:T.destination.lat,children:Object(Z.jsx)(Y,{dataTestId:"destination",style:{fill:"#64be14",stroke:"#fff"}})}),T.popupCoordinates&&Object(Z.jsxs)(x.c,{open:null!=T.popupCoordinates,latitude:(null===(r=T.popupCoordinates)||void 0===r?void 0:r.lat)||null,longitude:(null===(c=T.popupCoordinates)||void 0===c?void 0:c.lon)||null,closeButton:!1,closeOnClick:!1,children:[Object(Z.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"30px 1fr 30px"},children:[Object(Z.jsx)("div",{}),Object(Z.jsxs)("div",{style:{fontSize:"14px",fontWeight:"bold"},children:[null===(l=T.popupCoordinates.tags)||void 0===l?void 0:l["addr:street"]," ",null===(y=T.popupCoordinates.tags)||void 0===y?void 0:y["addr:housenumber"]," ",(null===(C=T.popupCoordinates.tags)||void 0===C?void 0:C.ref)||(null===(_=T.popupCoordinates.tags)||void 0===_?void 0:_["addr:unit"])]}),Object(Z.jsx)("div",{style:{textAlign:"right"},children:Object(Z.jsx)("a",{"aria-label":"Comment",href:function(e,t){if("loading"===(null===t||void 0===t?void 0:t.state))return null;var n,o=q(t);return o?le(o):-1===(n=e).id?"https://app.olmap.org/#/Notes/new/photo/@".concat(n.lat,",").concat(n.lon):"https://app.olmap.org/#/Notes/new/".concat(n.id,"/photo/@").concat(n.lat,",").concat(n.lon)}(T.popupCoordinates,T.olmapData)||"#",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex"},onClick:H,children:Object(Z.jsx)(m.a,{style:{color:"#ff5000",backgroundColor:"#fff"}})})})]}),Object(Z.jsx)(he,{onImageClick:H,olmapData:T.olmapData}),T.popupCoordinates.tags&&Object(Z.jsx)("table",{style:{marginTop:"10px",marginBottom:"10px",textAlign:"left"},children:Object(Z.jsx)("tbody",{children:Object.entries(T.popupCoordinates.tags).filter((function(e){var t=Object(f.a)(e,1)[0];return!t.startsWith("@")&&!["addr:street","addr:housenumber","addr:unit","ref"].includes(t)})).map((function(e){var t=Object(f.a)(e,2),n=t[0],o=t[1];return Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{style:{padding:"0 5px 0 0",textAlign:"right"},children:n}),Object(Z.jsx)("td",{children:o})]},"".concat(n,"-").concat(o))}))})}),Object(Z.jsxs)("div",{style:{display:"flex",justifyContent:"center"},children:[Object(Z.jsx)(h.a,{"data-testid":"origin-button",variant:"contained",size:"small",style:{backgroundColor:"#00afff",color:"#fff"},type:"button","aria-label":"Set origin",onClick:function(){return N((function(e){return null!=e.popupCoordinates?Object(d.a)(Object(d.a)({},e),{},{origin:Ye(e.popupCoordinates),isOriginExplicit:!0,popupCoordinates:null}):Object(d.a)(Object(d.a)({},e),{},{isOriginExplicit:!0,popupCoordinates:null})}))},children:"Origin"}),Object(Z.jsx)("span",{style:{padding:"5px"}}),Object(Z.jsx)(h.a,{"data-testid":"destination-button",variant:"contained",size:"small",style:{backgroundColor:"#64be14",color:"#fff"},type:"button","aria-label":"Set destination",onClick:function(){return N((function(e){return null!=e.popupCoordinates?Object(d.a)(Object(d.a)({},e),{},{destination:e.popupCoordinates,popupCoordinates:null}):Object(d.a)(Object(d.a)({},e),{},{popupCoordinates:null})}))},children:"Destination"})]})]})]})),Object(Z.jsx)(be,{noteId:T.editingNote,onClose:function(){return N((function(e){return Object(d.a)(Object(d.a)({},e),{},{editingNote:void 0})}))}}),Object(Z.jsx)($e,{open:T.venueDialogOpen,collapsed:T.venueDialogCollapsed,venueOlmapData:T.venueOlmapData,onEntranceSelected:function(e){N((function(t){var n=t.venueFeatures.features.filter((function(e){var t;return"Point"===e.geometry.type&&(null===(t=e.properties)||void 0===t?void 0:t.entrance)})),o=t.venueFeatures.features.find((function(t){var n;return(null===(n=t.properties)||void 0===n?void 0:n["@id"])==="http://www.openstreetmap.org/node/".concat(e)}));return Object(d.a)(Object(d.a)({},t),{},{unloadingPlace:void 0,destination:o&&"Point"===o.geometry.type&&et(o)||void 0,entrances:n.map((function(e){return et(e)}))})}))},onUnloadingPlaceSelected:function(e){N((function(t){var n=t.venueFeatures.features.filter((function(e){var t;return"Point"===e.geometry.type&&(null===(t=e.properties)||void 0===t?void 0:t.entrance)}));return Object(d.a)(Object(d.a)({},t),{},{unloadingPlace:e,destination:t.venue,entrances:n.map((function(e){return et(e)}))})}))},onClose:function(){return N((function(e){return Object(d.a)(Object(d.a)({},e),{},{venueDialogOpen:!1,venueDialogCollapsed:!1,venueOlmapData:void 0,venueFeatures:tt,venue:void 0})}))},onCollapsingToggled:function(){return N((function(e){return Object(d.a)(Object(d.a)({},e),{},{venueDialogCollapsed:!T.venueDialogCollapsed})}))}})]})}}},0,[4,2]]);
//# sourceMappingURL=App.eaddd9a7.chunk.js.map