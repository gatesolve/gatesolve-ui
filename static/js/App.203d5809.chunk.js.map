{"version":3,"sources":["map-style.ts","components/Pin.tsx","components/UserPosition.tsx","components/GeolocateControl.tsx","planner.ts","overpass.ts","mapbox-utils.ts","App.tsx"],"names":["routeLineLayer","id","type","layout","paint","filter","routeImaginaryLineLayer","routePointLayer","allEntrancesLayer","minzoom","allEntrancesSymbolLayer","routePointSymbolLayer","SVG_PATH","Pin","height","style","fill","stroke","dataTestId","data-testid","viewBox","pointerEvents","d","cursor","gradientTransform","offset","stopColor","stopOpacity","UserPosition","width","strokeWidth","position","cx","cy","r","GeolocateControl","onGeolocate","onGeolocateError","positionOptions","enableHighAccuracy","timeout","onEnable","onDisable","enableOnMount","useState","window","navigator","geolocation","isGeolocationSupported","permissions","isPermissionsSupported","permissionState","setPermissionState","watchID","setWatchId","hasBeenUsed","setHasBeenUsed","startWatching","isInitiatedByUser","watchPosition","stopWatching","clearWatch","showWarningOfDeniedGeolocation","console","log","useEffect","query","name","then","permissionStatus","state","onchange","this","catch","error","isClickingAllowed","isGeolocationOn","element","ariaLabel","buttonClassName","className","aria-label","aria-pressed","onContextMenu","event","preventDefault","onClick","assert","undefined","aria-hidden","extractGeometry","path","coordinates","obstacles","obstacleWays","Map","imaginaryWays","legs","getSteps","forEach","step","index","startLocation","stopLocation","node","context","through","definedTags","has","set","get","push","longitude","latitude","replace","freeformTags","Array","from","values","geometryToGeoJSON","origin","targets","entrances","routeGeometries","features","geometry","properties","color","target","lon","lat","entrance","ref","tags","opacity","imaginary","callback","a","Planner","planner","setProfileID","process","to","take","on","completePath","geoJSON","getMapSize","mapboxgl","getContainer","clientWidth","clientHeight","latLngToDestination","latLng","destinationToLatLng","destination","initialState","route","viewport","zoom","bearing","pitch","isOriginExplicit","isGeolocating","geolocationPosition","popupCoordinates","metropolitanAreaCenter","transformRequest","originalURL","url","distance","turfDistance","units","parseLatLng","text","parts","split","length","map","Number","isNaN","fitBounds","viewportOptions","latLngs","WebMercatorViewport","inputs","x","minLng","Math","min","maxLng","max","minLat","maxLat","padding","top","bottom","left","right","maxZoom","App","useRef","current","getMap","iconId","startsWith","size","svgData","pinAsSVG","imageId","ratio","devicePixelRatio","canvas","document","createElement","ctx","getContext","img","Image","svgDataUrl","encodeURIComponent","onload","Error","drawImage","addImage","getImageData","pixelRatio","src","addImageSVG","urlMatch","useRouteMatch","setState","fitMap","params","extendedViewport","prevState","history","useHistory","snackbarFunctions","useSnackbar","enqueueSnackbar","closeSnackbar","location","pathname","URL","searchParams","append","fetch","toString","response","json","body","elements","queryEntrances","result","snackbar","message","variant","persist","anchorOrigin","vertical","horizontal","action","Button","rel","href","IconButton","Close","calculatePlan","geojson","extendedGeojson","concat","handleMapClick","feature","queryRenderedFeatures","point","lngLat","lng","sources","highlightFirstSuggestion","inputProps","placeholder","center","onSuggestionSelected","suggestion","source_id","pointsToFit","mapStyle","onViewportChange","onHover","mapboxOverlaysElement","querySelector","onContextmenu","isFirstPosition","coords","updateBase","tiles","maxzoom","source-layer","source","data","draggable","onDragEnd","closeButton","closeOnClick","onClose"],"mappings":"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","file":"static/js/App.203d5809.chunk.js","sourcesContent":["import type { LayerProps } from \"react-map-gl\";\n\nexport const routeLineLayer: LayerProps = {\n  id: \"route-line\",\n  type: \"line\",\n  layout: {\n    \"line-cap\": \"round\",\n    \"line-join\": \"round\",\n  },\n  paint: {\n    \"line-opacity\": [\"coalesce\", [\"get\", \"opacity\"], 0.8],\n    \"line-width\": 2,\n    \"line-color\": [\"get\", \"color\"],\n  },\n  filter: [\"!\", [\"coalesce\", [\"get\", \"imaginary\"], false]],\n};\n\nexport const routeImaginaryLineLayer: LayerProps = {\n  id: \"route-imaginary-line\",\n  type: \"line\",\n  layout: {\n    \"line-cap\": \"round\",\n    \"line-join\": \"round\",\n  },\n  paint: {\n    \"line-opacity\": [\"coalesce\", [\"get\", \"opacity\"], 0.5],\n    \"line-width\": 5,\n    \"line-color\": [\"get\", \"color\"],\n    \"line-dasharray\": [0, 2],\n  },\n  filter: [\"coalesce\", [\"get\", \"imaginary\"], false],\n};\n\nexport const routePointLayer: LayerProps = {\n  id: \"route-point\",\n  type: \"circle\",\n  paint: {\n    \"circle-opacity\": [\"coalesce\", [\"get\", \"opacity\"], 1],\n    \"circle-radius\": 5,\n    \"circle-color\": [\"get\", \"color\"],\n  },\n  filter: [\"==\", \"Point\", [\"geometry-type\"]],\n};\n\nexport const allEntrancesLayer: LayerProps = {\n  id: \"entrance-point\",\n  type: \"circle\",\n  minzoom: 12,\n  paint: {\n    \"circle-radius\": [\n      \"interpolate\",\n      [\"linear\"],\n      [\"zoom\"],\n      12, // At zoom 12 or less,\n      1, // circle radius is 1.\n      14, // At zoom 14,\n      3, // circle radius is 3.\n      15, // At zoom 15 or more,\n      5, // circle radius is 5.\n    ],\n    \"circle-color\": \"#64be14\",\n  },\n  filter: [\"has\", \"entrance\"],\n};\n\nexport const allEntrancesSymbolLayer: LayerProps = {\n  id: \"entrance-symbol\",\n  type: \"symbol\",\n  minzoom: 16,\n  paint: {\n    \"text-halo-color\": \"#fff\",\n    \"text-color\": \"#64be14\",\n    \"text-halo-width\": 3,\n  },\n  layout: {\n    \"text-field\": [\"coalesce\", [\"get\", \"ref\"], [\"get\", \"addr:unit\"]],\n    \"text-anchor\": \"center\",\n    \"text-font\": [\"Klokantech Noto Sans Regular\"],\n    \"text-size\": 24,\n    \"text-offset\": [0, -0.8],\n    \"text-allow-overlap\": true,\n  },\n  filter: [\"has\", \"entrance\"],\n};\n\nexport const routePointSymbolLayer: LayerProps = {\n  id: \"route-point-symbol\",\n  type: \"symbol\",\n  paint: {\n    \"text-color\": \"#000\",\n    \"text-halo-color\": \"#fff\",\n    \"text-halo-width\": 3,\n  },\n  layout: {\n    \"text-field\": [\"get\", \"ref\"],\n    \"text-anchor\": \"center\",\n    \"text-font\": [\"Klokantech Noto Sans Regular\"],\n    \"text-size\": 24,\n    \"text-offset\": [0, -0.05],\n  },\n  filter: [\"==\", \"Point\", [\"geometry-type\"]],\n};\n","import React from \"react\";\n\nexport interface PinProps {\n  height?: string;\n  style?: React.CSSProperties;\n  dataTestId?: string;\n}\n\nconst SVG_VIEWBOX = \"-1 -1 17 17\";\nconst SVG_PATH =\n  \"M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73c1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z\";\n\nexport const pinAsSVG = (size: number, style: string): string => `\n<svg xmlns=\"http://www.w3.org/2000/svg\"\n  width=\"${size}px\"\n  height=\"${size}px\"\n  style=\"${style}\"\n  viewBox=\"${SVG_VIEWBOX}\"\n>\n  <path d=\"${SVG_PATH}\" />\n</svg>`;\n\nconst Pin: React.FC<PinProps> = ({\n  height = \"50\",\n  style = { fill: \"#444\", stroke: \"none\" },\n  dataTestId,\n}) => {\n  return (\n    <svg\n      data-testid={dataTestId}\n      height={height}\n      style={style}\n      viewBox={SVG_VIEWBOX}\n      pointerEvents=\"none\"\n    >\n      <path\n        fill={`url(#gradient-${style.fill})`}\n        d={SVG_PATH}\n        pointerEvents=\"visiblepainted\"\n        cursor=\"pointer\"\n      />\n      <defs>\n        <linearGradient\n          id={`gradient-${style.fill}`}\n          gradientTransform=\"rotate(90)\"\n        >\n          <stop offset=\"00%\" stopColor=\"#FFFFFF\" stopOpacity=\"0\" />\n          <stop offset=\"100%\" stopColor={style.fill} stopOpacity=\"1\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n};\n\nexport default Pin;\n","import React from \"react\";\n\nexport interface UserPositionProps {\n  dataTestId?: string;\n  width?: string;\n  height?: string;\n  stroke?: string;\n  strokeWidth?: string;\n}\n\nconst UserPosition: React.FC<UserPositionProps> = ({\n  dataTestId,\n  width = \"40\",\n  height = \"40\",\n  stroke = \"#00afff\",\n  strokeWidth = \"16\",\n}) => (\n  <svg\n    data-testid={dataTestId}\n    width={width}\n    height={height}\n    stroke={stroke}\n    strokeWidth={strokeWidth}\n    viewBox=\"-100 -100 200 200\"\n    fill=\"transparent\"\n    style={{ position: \"absolute\" }}\n  >\n    <circle cx=\"0\" cy=\"0\" r=\"24\" />\n    <circle cx=\"0\" cy=\"0\" r=\"46\" />\n    <circle cx=\"0\" cy=\"0\" r=\"68\" />\n  </svg>\n);\n\nexport default UserPosition;\n","import React, { useState, useEffect } from \"react\";\nimport type { MouseEventHandler } from \"react\";\n\nexport interface GeolocateControlProps {\n  dataTestId?: string;\n  onGeolocate: PositionCallback;\n  onGeolocateError?: PositionErrorCallback;\n  positionOptions?: PositionOptions;\n  onEnable?: (isInitiatedByUser: boolean) => void;\n  onDisable?: () => void;\n  enableOnMount?: boolean;\n}\n\nconst GeolocateControl: React.FC<GeolocateControlProps> = ({\n  dataTestId,\n  onGeolocate,\n  onGeolocateError,\n  positionOptions = { enableHighAccuracy: true, timeout: 6000 },\n  onEnable,\n  onDisable,\n  enableOnMount = true,\n}) => {\n  const [isGeolocationSupported] = useState(\n    window.navigator.geolocation != null\n  );\n  const [isPermissionsSupported] = useState(\n    window.navigator.permissions != null\n  );\n  const [permissionState, setPermissionState] = useState(\n    null as PermissionState | null\n  );\n  const [watchID, setWatchId] = useState(null as number | null);\n  const [hasBeenUsed, setHasBeenUsed] = useState(false);\n\n  const checkGeolocationPermission = (): void => {\n    if (isPermissionsSupported) {\n      window.navigator.permissions\n        .query({ name: \"geolocation\" })\n        .then((permissionStatus) => {\n          setPermissionState(permissionStatus.state);\n          function setPermissionStateOnChange(this: PermissionStatus): void {\n            setPermissionState(this.state);\n          }\n          // eslint-disable-next-line no-param-reassign\n          permissionStatus.onchange = setPermissionStateOnChange;\n        })\n        .catch((error) => {\n          // FIXME: Warn properly\n          // eslint-disable-next-line no-console\n          console.error(\"Permissions API exists but querying it fails:\", error);\n        });\n    }\n  };\n\n  const startWatching = (isInitiatedByUser: boolean): void => {\n    if (isGeolocationSupported && watchID == null) {\n      setWatchId(\n        window.navigator.geolocation.watchPosition(\n          onGeolocate,\n          onGeolocateError,\n          positionOptions\n        )\n      );\n      setHasBeenUsed(true);\n      if (onEnable != null) {\n        onEnable(isInitiatedByUser);\n      }\n    }\n  };\n\n  const stopWatching = (): void => {\n    if (isGeolocationSupported && watchID != null) {\n      /**\n       * Based on reading the Geolocation API spec (\n       * https://www.w3.org/TR/2016/REC-geolocation-API-20161108/#geolocation_interface\n       * ) and trying out in practice on Chromium, one can call clearWatch\n       * regardless of permissions.\n       */\n      window.navigator.geolocation.clearWatch(watchID);\n      setWatchId(null);\n      if (onDisable != null) {\n        onDisable();\n      }\n    }\n  };\n\n  const showWarningOfDeniedGeolocation = (): void => {\n    // FIXME: Inform the user that geolocation is denied.\n    // eslint-disable-next-line no-console\n    console.log(\"Geolocation is denied. Inform the user.\");\n  };\n\n  // Inform the user once if geolocation is not supported.\n  useEffect(() => {\n    if (!isGeolocationSupported) {\n      // FIXME: Warn the user\n      // eslint-disable-next-line no-console\n      console.log(\"Geolocation is not supported. Inform the user.\");\n    }\n  }, [isGeolocationSupported]);\n\n  // Figure out the permissionState.\n  useEffect(() => {\n    if (\n      isGeolocationSupported &&\n      isPermissionsSupported &&\n      permissionState == null\n    ) {\n      checkGeolocationPermission();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Warn the user about denied permission.\n  useEffect(() => {\n    if (permissionState === \"denied\") {\n      showWarningOfDeniedGeolocation();\n      stopWatching();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [permissionState]);\n\n  /**\n   * If Permissions API is supported, only allow clicking once the\n   * PermissionState is known.\n   */\n  const isClickingAllowed = !isPermissionsSupported || permissionState != null;\n  const isGeolocationOn = watchID != null;\n\n  // Start watching on mount if asked.\n  useEffect(() => {\n    if (\n      enableOnMount &&\n      !hasBeenUsed &&\n      isGeolocationSupported &&\n      !isGeolocationOn &&\n      (!isPermissionsSupported ||\n        (permissionState != null && permissionState !== \"denied\"))\n    ) {\n      startWatching(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    enableOnMount,\n    hasBeenUsed,\n    isGeolocationSupported,\n    isGeolocationOn,\n    isPermissionsSupported,\n    permissionState,\n  ]);\n\n  const onClick: MouseEventHandler = (event) => {\n    /**\n     * Assume that Geolocation API exists.\n     *\n     * Assume either permissionState is known or the Permissios API is not\n     * supported.\n     */\n    // FIXME: Maybe find a way so this does not need to be remembered.\n    // eslint-disable-next-line no-console\n    console.assert(isGeolocationSupported);\n    // FIXME: Maybe find a way so this does not need to be remembered.\n    // FIXME: Remove these debug asserts\n    // eslint-disable-next-line no-console\n    console.assert(isClickingAllowed);\n    event.preventDefault();\n\n    if (!isGeolocationOn) {\n      if (isPermissionsSupported && permissionState === \"denied\") {\n        // Warn the user again if they press the button.\n        showWarningOfDeniedGeolocation();\n      } else {\n        startWatching(true);\n      }\n    } else {\n      stopWatching();\n    }\n  };\n\n  let element = null;\n  if (isGeolocationSupported) {\n    const ariaLabel = isGeolocationOn\n      ? \"Stop using my location\"\n      : \"Find my location\";\n    const buttonClassName = isGeolocationOn\n      ? \"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate mapboxgl-ctrl-geolocate-active\"\n      : \"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate\";\n    element = (\n      <div className=\"mapboxgl-ctrl mapboxgl-ctrl-group mapboxgl-ctrl-bottom-left\">\n        <button\n          type=\"button\"\n          className={buttonClassName}\n          data-testid={dataTestId}\n          aria-label={ariaLabel}\n          aria-pressed={isGeolocationOn}\n          onContextMenu={(event): void => event.preventDefault()}\n          onClick={isClickingAllowed ? onClick : undefined}\n        >\n          <span className=\"mapboxgl-ctrl-icon\" aria-hidden=\"true\" />\n        </button>\n      </div>\n    );\n  }\n  return element;\n};\n\nexport default GeolocateControl;\n","// eslint-disable-next-line import/no-extraneous-dependencies\nimport {\n  Feature,\n  FeatureCollection,\n  Geometry,\n  GeoJsonProperties,\n} from \"geojson\";\n\n// \"./planner-config\" (and PlannerJS) is imported dynamically by calculatePlan\n\nimport { ElementWithCoordinates } from \"./overpass\";\n\ninterface RouteGeometries {\n  coordinates: Array<[number, number]>;\n  obstacles: Array<[number, number]>;\n  obstacleWays: Array<Array<[number, number]>>;\n  imaginaryWays: Array<Array<[number, number]>>;\n}\n\nfunction extractGeometry(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  path: any\n): RouteGeometries {\n  const coordinates = [] as Array<[number, number]>;\n  const obstacles = [] as Array<[number, number]>;\n  const obstacleWays = new Map();\n  const imaginaryWays = [] as Array<Array<[number, number]>>;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  path.legs[0].getSteps().forEach((step: any, index: number) => {\n    /* XXX: Would be nice to get a null step.through from PlannerJS here.\n       Heuristic below: PlannerJS connects the origin and destination to\n       the nearest OSM ways through a node which does not have an id,\n       so the steps whose geometry is not based on an OSM way have\n       nodes without ids at both ends. Additionally, the second step is a\n       false positive if origin and destination connect to same OSM edge.\n     */\n    if (!step.startLocation.id && !step.stopLocation.id && index !== 1) {\n      imaginaryWays.push([\n        [\n          step.startLocation.longitude as number,\n          step.startLocation.latitude as number,\n        ],\n        [\n          step.stopLocation.longitude as number,\n          step.stopLocation.latitude as number,\n        ],\n      ]);\n      return; // guessed segment\n    }\n    const node = step.stopLocation;\n    if (\n      path.context[step.through]?.definedTags[\n        \"https://w3id.org/openstreetmap/terms#highway\"\n      ] === \"https://w3id.org/openstreetmap/terms#Steps\"\n    ) {\n      if (!obstacleWays.has(step.through)) {\n        obstacleWays.set(step.through, []);\n      }\n      obstacleWays\n        .get(step.through)\n        .push(\n          [\n            step.startLocation.longitude as number,\n            step.startLocation.latitude as number,\n          ],\n          [\n            step.stopLocation.longitude as number,\n            step.stopLocation.latitude as number,\n          ]\n        );\n    }\n    if (node.definedTags?.[\"https://w3id.org/openstreetmap/terms#barrier\"]) {\n      // eslint-disable-next-line no-console\n      console.log(\n        step.through,\n        node.definedTags[\n          \"https://w3id.org/openstreetmap/terms#barrier\"\n        ].replace(/^.*#/, \"\"),\n        node.id,\n        node.definedTags,\n        node.freeformTags\n      );\n      obstacles.push([node.longitude as number, node.latitude as number]);\n    }\n    coordinates.push([\n      step.startLocation.longitude as number,\n      step.startLocation.latitude as number,\n    ]);\n    coordinates.push([\n      step.stopLocation.longitude as number,\n      step.stopLocation.latitude as number,\n    ]);\n  });\n  return {\n    coordinates,\n    obstacles,\n    obstacleWays: Array.from(obstacleWays.values()),\n    imaginaryWays,\n  };\n}\n\nexport function geometryToGeoJSON(\n  origin?: [number, number],\n  targets?: Array<ElementWithCoordinates>,\n  entrances?: Array<ElementWithCoordinates>,\n  routeGeometries?: RouteGeometries\n): FeatureCollection {\n  const features = [] as Array<Feature<Geometry, GeoJsonProperties>>;\n  if (origin) {\n    features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"Point\",\n        coordinates: [origin[1], origin[0]],\n      },\n      properties: {\n        color: \"#00afff\",\n      },\n    });\n  }\n  if (targets) {\n    targets.forEach((target) => {\n      features.push({\n        type: \"Feature\",\n        geometry: {\n          type: \"Point\",\n          coordinates: [target.lon, target.lat],\n        },\n        properties: {\n          color: \"#64be14\",\n        },\n      });\n    });\n  }\n  if (entrances) {\n    entrances.forEach((entrance) => {\n      features.push({\n        type: \"Feature\",\n        geometry: {\n          type: \"Point\",\n          coordinates: [entrance.lon, entrance.lat],\n        },\n        properties: {\n          color: \"#00ffff\",\n          ref: entrance.tags?.[\"ref\"] || entrance.tags?.[\"addr:unit\"],\n          opacity: 0,\n        },\n      });\n    });\n  }\n  if (routeGeometries?.coordinates) {\n    features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"LineString\",\n        coordinates: routeGeometries.coordinates,\n      },\n      properties: {\n        color: \"#000\",\n      },\n    });\n  }\n  if (routeGeometries?.obstacleWays) {\n    features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"MultiLineString\",\n        coordinates: routeGeometries.obstacleWays,\n      },\n      properties: {\n        color: \"#dc0451\",\n        opacity: 1,\n      },\n    });\n  }\n  if (routeGeometries?.imaginaryWays) {\n    features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"MultiLineString\",\n        coordinates: routeGeometries.imaginaryWays,\n      },\n      properties: {\n        color: \"#000\",\n        imaginary: true,\n      },\n    });\n  }\n  if (routeGeometries?.obstacles) {\n    features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"MultiPoint\",\n        coordinates: routeGeometries.obstacles,\n      },\n      properties: {\n        color: \"#dc0451\",\n        ref: \"!\",\n      },\n    });\n  }\n  return {\n    type: \"FeatureCollection\",\n    features,\n  };\n}\n\nexport default async function calculatePlan(\n  origin: [number, number],\n  targets: Array<ElementWithCoordinates>,\n  callback: (f: FeatureCollection) => void\n): Promise<void> {\n  const { Planner } = await import(\n    /* webpackChunkName: \"planner-config\" */\n    /* webpackPrefetch: true */\n    \"./planner-config\"\n  );\n  targets.forEach((target) => {\n    const planner = new Planner();\n    // XXX setProfileID requires URL to start with scheme, so guess\n    const protocol = process.env.NODE_ENV === \"production\" ? \"https\" : \"http\";\n    planner\n      .setProfileID(`${protocol}://${process.env.PUBLIC_URL}/delivery.json`)\n      .query({\n        from: { latitude: origin[0], longitude: origin[1] },\n        to: { latitude: target.lat, longitude: target.lon },\n      })\n      .take(1)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      .on(\"data\", async (path: any) => {\n        const completePath = await planner.completePath(path);\n        // eslint-disable-next-line no-console\n        console.log(\"Plan\", completePath, \"from\", origin, \"to\", target);\n        const routeGeometries = extractGeometry(completePath);\n        const geoJSON = geometryToGeoJSON(\n          origin,\n          [target],\n          undefined,\n          routeGeometries\n        );\n        callback(geoJSON);\n      });\n  });\n}\n","export interface OverpassResponse {\n  version: number;\n  generator: string;\n  osm3s: Osm3S;\n  elements: Element[];\n}\n\nexport interface Osm3S {\n  timestamp_osm_base: Date;\n  copyright: string;\n}\n\nexport type Element =\n  | ElementWithCoordinates\n  | (ElementCore & Partial<Coordinates>);\n\nexport type ElementWithCoordinates = ElementCore & Coordinates;\n\ninterface ElementCore {\n  type: string;\n  id: number;\n  tags?: Tags;\n}\n\nexport interface Coordinates {\n  lat: number;\n  lon: number;\n}\n\nexport interface Tags {\n  entrance?: string;\n  operator?: string;\n  ref?: string;\n  \"addr:unit\"?: string;\n}\n\nconst buildEntranceQuery = (lat: number, lon: number): string => `\n  [out:json][timeout:25];\n  (\n    relation(around:10, ${lat}, ${lon})[building];\n    way(r);\n    way(around:10, ${lat}, ${lon})[building];\n  )->.b;\n  // gather results\n  (\n    node(w.b)[entrance];\n  );\n  // print results\n  out body;\n  >;\n  out skel qt;\n`;\n\nexport const queryEntrances = (\n  target: ElementWithCoordinates\n): Promise<ElementWithCoordinates[]> => {\n  const url = new URL(\"https://overpass.rwqr.org/api/interpreter\");\n  url.searchParams.append(\"data\", buildEntranceQuery(target.lat, target.lon));\n  return fetch(url.toString()).then((response) =>\n    response.json().then((body: OverpassResponse) => {\n      const targets = body.elements.filter(\n        (element) =>\n          element.type === \"node\" &&\n          \"lat\" in element &&\n          element.lat != null &&\n          \"lon\" in element &&\n          element.lon != null &&\n          element.tags &&\n          element.tags.entrance\n      );\n      // FIXME: How to make the compiler deduce this by itself from above?\n      // For example, see https://github.com/Microsoft/TypeScript/issues/16069\n      return targets as ElementWithCoordinates[];\n    })\n  );\n};\n","import { Map } from \"mapbox-gl\";\n\n// eslint-disable-next-line import/prefer-default-export\nexport const addImageSVG = (\n  mapboxgl: Map,\n  imageId: string,\n  svgData: string,\n  size: number\n): void => {\n  const ratio = window.devicePixelRatio;\n\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = ratio * size;\n  canvas.height = ratio * size;\n\n  const ctx = canvas.getContext(\"2d\");\n  const img = new Image(size, size);\n\n  const svgDataUrl = `data:image/svg+xml,${encodeURIComponent(svgData)}`;\n\n  img.onload = (): void => {\n    if (!ctx) {\n      throw Error(\"canvas.getContext failed\");\n    }\n\n    ctx.drawImage(img, 0, 0, ratio * size, ratio * size);\n    mapboxgl.addImage(\n      imageId,\n      ctx.getImageData(0, 0, ratio * size, ratio * size),\n      { pixelRatio: ratio }\n    );\n  };\n\n  img.src = svgDataUrl;\n};\n\nexport const getMapSize = (\n  mapboxgl: Map\n): { width: number; height: number } => ({\n  width: mapboxgl?.getContainer()?.clientWidth,\n  height: mapboxgl?.getContainer()?.clientHeight,\n});\n","import React, { useState, useEffect, useRef, ReactText } from \"react\";\nimport { useRouteMatch, useHistory } from \"react-router-dom\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport type { match } from \"react-router-dom\";\nimport { Button, IconButton } from \"@material-ui/core\";\nimport { Close as CloseIcon } from \"@material-ui/icons\";\nimport { useSnackbar } from \"notistack\";\nimport MapGL, { Popup, Source, Layer, Marker } from \"@urbica/react-map-gl\";\nimport { WebMercatorViewport } from \"viewport-mercator-project\";\nimport type { WebMercatorViewportOptions } from \"viewport-mercator-project\";\nimport { distance as turfDistance } from \"@turf/turf\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { FeatureCollection } from \"geojson\";\nimport { ReactAutosuggestGeocoder } from \"react-autosuggest-geocoder\";\n\nimport {\n  routePointLayer,\n  routePointSymbolLayer,\n  routeLineLayer,\n  routeImaginaryLineLayer,\n  allEntrancesLayer,\n  allEntrancesSymbolLayer,\n} from \"./map-style\";\nimport Pin, { pinAsSVG } from \"./components/Pin\";\nimport UserPosition from \"./components/UserPosition\";\nimport GeolocateControl from \"./components/GeolocateControl\";\nimport calculatePlan, { geometryToGeoJSON } from \"./planner\";\nimport { queryEntrances, ElementWithCoordinates } from \"./overpass\";\nimport { addImageSVG, getMapSize } from \"./mapbox-utils\";\nimport \"./App.css\";\nimport \"./components/PinMarker.css\";\n\nconst maxRoutingDistance = 200; // in meters\n\ntype LatLng = [number, number];\n\ninterface State {\n  viewport: WebMercatorViewportOptions;\n  isOriginExplicit: boolean;\n  origin?: LatLng;\n  destination?: ElementWithCoordinates;\n  entrances?: Array<ElementWithCoordinates>;\n  route: FeatureCollection;\n  isGeolocating: boolean;\n  geolocationPosition: LatLng | null;\n  popupCoordinates: LatLng | null;\n  snackbar?: ReactText;\n}\n\nconst latLngToDestination = (latLng: LatLng): ElementWithCoordinates => ({\n  id: -1,\n  type: \"node\",\n  lat: latLng[0],\n  lon: latLng[1],\n});\n\nconst destinationToLatLng = (destination: ElementWithCoordinates): LatLng => [\n  destination.lat,\n  destination.lon,\n];\n\nconst initialState: State = {\n  entrances: [],\n  route: geometryToGeoJSON(),\n  viewport: {\n    latitude: 60.17,\n    longitude: 24.941,\n    zoom: 15,\n    bearing: 0,\n    pitch: 0,\n  },\n  isOriginExplicit: false,\n  isGeolocating: false,\n  geolocationPosition: null,\n  popupCoordinates: null,\n};\n\nconst metropolitanAreaCenter = [60.17066815612902, 24.941510260105133];\n\nconst transformRequest = (originalURL: string): { url: string } => {\n  const url = originalURL.replace(\n    \"https://static.hsldev.com/mapfonts/Klokantech Noto Sans\",\n    \"https://fonts.openmaptiles.org/Klokantech Noto Sans\"\n  );\n  return { url };\n};\n\nconst distance = (from: LatLng, to: LatLng): number =>\n  turfDistance([from[1], from[0]], [to[1], to[0]], { units: \"metres\" });\n\nconst parseLatLng = (text: string | undefined): LatLng | undefined => {\n  if (text) {\n    const parts = text.split(\",\");\n    if (parts.length === 2 && parts[0].length && parts[1].length) {\n      const [lat, lon] = parts.map(Number);\n      if (!Number.isNaN(lat) && lon > -90 && lon < 90) {\n        return [lat, lon];\n      }\n    }\n  }\n  return undefined;\n};\n\nconst fitBounds = (\n  viewportOptions: WebMercatorViewportOptions,\n  latLngs: Array<LatLng | undefined>\n): WebMercatorViewportOptions => {\n  const viewport = new WebMercatorViewport(viewportOptions);\n  const inputs = latLngs.filter((x) => x) as Array<LatLng>;\n  if (!inputs.length) return viewportOptions; // Nothing to do\n  const minLng = Math.min(...inputs.map((x) => x[1]));\n  const maxLng = Math.max(...inputs.map((x) => x[1]));\n  const minLat = Math.min(...inputs.map((x) => x[0]));\n  const maxLat = Math.max(...inputs.map((x) => x[0]));\n  const padding = 20;\n  const markerSize = 50;\n  const occludedTop = 40;\n  const circleRadius = 5;\n  return viewport.fitBounds(\n    [\n      [minLng, minLat],\n      [maxLng, maxLat],\n    ],\n    {\n      padding: {\n        top: padding + occludedTop + markerSize,\n        bottom: padding + circleRadius,\n        left: padding + markerSize / 2,\n        right: padding + markerSize / 2,\n      },\n      maxZoom: 17,\n    } as any // eslint-disable-line @typescript-eslint/no-explicit-any\n    // XXX above: @types/viewport-mercator-project is missing maxZoom\n  );\n};\n\nconst App: React.FC = () => {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const map = useRef<any>(null);\n\n  // Install a callback to dynamically create pin icons that our map styles use\n  useEffect(() => {\n    if (!map.current) {\n      return; // No map yet, so nothing to do\n    }\n    const mapboxgl = map.current.getMap();\n    // FIXME: Unclear why this passed type checking before.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    mapboxgl?.on(\"styleimagemissing\", ({ id: iconId }: any) => {\n      if (!iconId?.startsWith(\"icon-pin-\")) {\n        return; // We only know how to generate pin icons\n      }\n      const [, , size, fill, stroke] = iconId.split(\"-\"); // e.g. icon-pin-48-green-#fff\n      const svgData = pinAsSVG(size, `fill: ${fill}; stroke: ${stroke}`);\n      addImageSVG(mapboxgl, iconId, svgData, size);\n    });\n  }, [map]);\n\n  const urlMatch = useRouteMatch({\n    path: \"/route/:from?/:to?\",\n  }) as match<{ from: string; to: string }>;\n\n  const [state, setState] = useState(initialState);\n\n  const fitMap = (\n    viewportOptions: WebMercatorViewportOptions,\n    latLngs: Array<LatLng | undefined>\n  ): WebMercatorViewportOptions => {\n    return fitBounds(\n      { ...viewportOptions, ...getMapSize(map.current?.getMap()) },\n      latLngs\n    );\n  };\n\n  useEffect(() => {\n    /**\n     * FIXME: urbica/react-map-gl does not expose fitBounds and its viewport\n     * does not include width and height which are required by fitBounds from\n     * viewport-mercator-project. This is dirty but seems to work.\n     */\n    if (!map.current) {\n      return; // No map yet, so nothing to do\n    }\n    const { width, height } = getMapSize(map.current.getMap());\n    if (\n      urlMatch &&\n      width != null &&\n      width > 0 &&\n      height != null &&\n      height > 0\n    ) {\n      const origin = parseLatLng(urlMatch.params.from);\n      const destination = parseLatLng(urlMatch.params.to);\n      const extendedViewport = { ...state.viewport, width, height };\n      const viewport = fitBounds(extendedViewport, [origin, destination]);\n      setState(\n        (prevState): State => ({\n          ...prevState,\n          origin,\n          isOriginExplicit: origin != null,\n          destination: destination && latLngToDestination(destination),\n          viewport: { ...prevState.viewport, ...viewport },\n        })\n      );\n    }\n  }, [map]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const history = useHistory();\n\n  const snackbarFunctions = useSnackbar();\n  // XXX: useSnackbar does not return functions during unit tests\n  const enqueueSnackbar = snackbarFunctions?.enqueueSnackbar;\n  const closeSnackbar = snackbarFunctions?.closeSnackbar;\n\n  useEffect(() => {\n    const destination = state.destination && [\n      state.destination.lat,\n      state.destination.lon,\n    ];\n    const path = `/route/${state.origin}/${destination}/`;\n    if (history.location.pathname !== path) {\n      history.replace(path);\n    }\n  }, [history, state.origin, state.destination]);\n\n  useEffect(() => {\n    if (!state.destination) return; // Nothing to do yet\n    queryEntrances(state.destination).then((result) => {\n      setState(\n        (prevState): State => {\n          if (!state.destination) return prevState; // XXX Typescript needs this\n          if (prevState.destination !== state.destination) {\n            return prevState;\n          }\n          const entrances = result.length ? result : [state.destination];\n\n          return {\n            ...prevState,\n            entrances,\n          };\n        }\n      );\n    });\n  }, [state.destination]);\n\n  // Set off routing calculation when inputs change; collect results in state.route\n  useEffect(() => {\n    if (state.snackbar) closeSnackbar(state.snackbar);\n\n    if (!state.origin || !state.destination || !state.entrances) {\n      return; // Nothing to do yet\n    }\n    let targets = [] as Array<ElementWithCoordinates>;\n\n    // Try to find the destination among the entrances\n    state.entrances.forEach((entrance) => {\n      if (!state.destination) return; // XXX: Typescript needs this\n      if (\n        state.destination.type === entrance.type &&\n        state.destination.id === entrance.id\n      ) {\n        targets = [entrance];\n      }\n    });\n\n    // If the destination entrance wasn't found, route to all entrances\n    if (!targets.length) {\n      targets = state.entrances;\n    }\n\n    // Clear previous routing results by setting an empty result set\n    setState(\n      (prevState): State => ({\n        ...prevState,\n        route: geometryToGeoJSON(),\n      })\n    );\n\n    // Don't calculate routes between points more than 200 meters apart\n    if (\n      distance(state.origin, destinationToLatLng(state.destination)) >\n      maxRoutingDistance\n    ) {\n      const message = state.isOriginExplicit\n        ? \"Distance too long!\"\n        : \"Routing starts when distance is shorter\";\n      const snackbar = enqueueSnackbar(message, {\n        variant: \"warning\",\n        persist: true,\n        anchorOrigin: {\n          vertical: \"bottom\",\n          horizontal: \"center\",\n        },\n        action: (\n          <>\n            {state.isOriginExplicit && (\n              <Button\n                onClick={(): void => {\n                  setState(\n                    (prevState): State => ({\n                      ...prevState,\n                      origin: prevState.geolocationPosition || undefined,\n                      isOriginExplicit: false,\n                      viewport: fitMap(prevState.viewport, [\n                        prevState.destination &&\n                          destinationToLatLng(prevState.destination),\n                      ]),\n                    })\n                  );\n                }}\n              >\n                Discard origin\n              </Button>\n            )}\n            <Button\n              onClick={(): void => {\n                setState(\n                  (prevState): State => ({\n                    ...prevState,\n                    destination: undefined,\n                    viewport: fitMap(prevState.viewport, [prevState.origin]),\n                  })\n                );\n              }}\n            >\n              Discard destination\n            </Button>\n            <Button\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              href={`https://www.google.com/maps/dir/?api=1&origin=${state.origin[0]},${state.origin[1]}&destination=${state.destination.lat},${state.destination.lon}`}\n            >\n              Google Maps\n            </Button>\n\n            <IconButton\n              aria-label=\"close\"\n              onClick={(): void => closeSnackbar(snackbar)}\n            >\n              <CloseIcon />\n            </IconButton>\n          </>\n        ),\n      });\n      setState((prevState): State => ({ ...prevState, snackbar }));\n      return;\n    }\n\n    calculatePlan(state.origin, targets, (geojson) => {\n      setState(\n        (prevState): State => {\n          // don't use the result if the parameters changed meanwhile\n          if (\n            state.origin !== prevState.origin ||\n            state.entrances !== prevState.entrances ||\n            state.destination !== prevState.destination\n          ) {\n            return prevState;\n          }\n          const extendedGeojson = {\n            ...geojson,\n            features: geojson.features.concat(prevState.route.features),\n          };\n          return {\n            ...prevState,\n            route: extendedGeojson,\n          };\n        }\n      );\n    });\n  }, [state.origin, state.entrances]); // eslint-disable-line react-hooks/exhaustive-deps\n  // XXX: state.destination is missing above as we need to wait for state.entrances to change as well\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const handleMapClick = (event: any): void => {\n    // Inspect the topmost feature under click\n    const feature = map.current?.getMap().queryRenderedFeatures(event.point)[0];\n    setState(\n      (prevState): State => {\n        if (feature?.properties.entrance) {\n          // If an entrance was clicked, set it as the destination\n          return {\n            ...prevState,\n            destination: {\n              id: feature.properties[\"@id\"],\n              type: feature.properties[\"@type\"],\n              lat: feature.geometry.coordinates[1],\n              lon: feature.geometry.coordinates[0],\n            },\n          };\n        }\n        // As a fallback, open a popup.\n        return {\n          ...prevState,\n          popupCoordinates: [event.lngLat.lat, event.lngLat.lng],\n        };\n      }\n    );\n  };\n\n  /**\n   * Two tasks:\n   * - update geolocation position into state\n   * - change origin if deemed appropriate\n   */\n  const onGeolocate = (position: Position): void =>\n    setState(\n      (prevState): State => {\n        if (prevState.isGeolocating) {\n          const isFirstPosition = prevState.geolocationPosition == null;\n          const geolocationPosition: LatLng = [\n            position.coords.latitude,\n            position.coords.longitude,\n          ];\n          const viewport =\n            isFirstPosition && !prevState.isOriginExplicit\n              ? fitMap(prevState.viewport, [\n                  geolocationPosition,\n                  prevState.destination &&\n                    destinationToLatLng(prevState.destination),\n                ])\n              : prevState.viewport;\n          const updateBase = { ...prevState, geolocationPosition, viewport };\n          if (\n            !prevState.isOriginExplicit &&\n            (prevState.origin == null ||\n              distance(prevState.origin, geolocationPosition) > 20)\n          ) {\n            return { ...updateBase, origin: geolocationPosition };\n          }\n          return updateBase;\n        }\n        return prevState;\n      }\n    );\n\n  return (\n    <div data-testid=\"app\" className=\"App\">\n      <header className=\"App-header\">\n        <h2>Gatesolve</h2>\n      </header>\n      <div className=\"App-shadow\" />\n      <ReactAutosuggestGeocoder\n        url=\"https://api.digitransit.fi/geocoding/v1\"\n        sources=\"oa,osm,nlsfi\"\n        highlightFirstSuggestion\n        inputProps={{ placeholder: \"Destination name or address\" }}\n        center={{\n          latitude:\n            state.geolocationPosition?.[0] ||\n            state.origin?.[0] ||\n            state.destination?.lat ||\n            metropolitanAreaCenter[0],\n          longitude:\n            state.geolocationPosition?.[1] ||\n            state.origin?.[1] ||\n            state.destination?.lon ||\n            metropolitanAreaCenter[1],\n        }}\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        onSuggestionSelected={(event: any, { suggestion }: any): any => {\n          const destination: LatLng = [\n            suggestion.geometry.coordinates[1],\n            suggestion.geometry.coordinates[0],\n          ];\n          const [type, id] = suggestion.properties.source_id.split(\":\");\n          setState(\n            (prevState): State => {\n              const pointsToFit =\n                prevState.origin &&\n                distance(prevState.origin, destination) < maxRoutingDistance\n                  ? [prevState.origin, destination]\n                  : [destination];\n              const viewport = fitMap(prevState.viewport, pointsToFit);\n              return {\n                ...prevState,\n                origin: prevState.origin,\n                destination: {\n                  lat: destination[0],\n                  lon: destination[1],\n                  type,\n                  id: Number(id),\n                },\n                entrances: [],\n                viewport: { ...prevState.viewport, ...viewport },\n              };\n            }\n          );\n        }}\n      />\n      <MapGL\n        ref={map}\n        // This is according to the Get Started materials:\n        // https://uber.github.io/react-map-gl/docs/get-started/get-started/\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...state.viewport}\n        style={{ width: \"100%\", height: \"90%\" }}\n        mapStyle=\"https://raw.githubusercontent.com/HSLdevcom/hsl-map-style/master/simple-style.json\"\n        transformRequest={transformRequest}\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        onViewportChange={(viewport: any): void => {\n          setState((prevState): State => ({ ...prevState, viewport }));\n        }}\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        onHover={(event: any): void => {\n          // Inspect the topmost feature under click\n          const feature = event.features?.[0];\n          // Set cursor shape depending whether we would click an entrance\n          const cursor = feature?.properties.entrance ? \"pointer\" : \"grab\";\n          // FIXME: Better way to set the pointer shape or at least find the element\n          const mapboxOverlaysElement = document.querySelector(\n            \".overlays\"\n          ) as HTMLElement;\n          if (mapboxOverlaysElement) {\n            mapboxOverlaysElement.style.cursor = cursor;\n          }\n        }}\n        onClick={handleMapClick}\n        onContextmenu={handleMapClick}\n      >\n        <GeolocateControl\n          dataTestId=\"geolocate-control\"\n          enableOnMount\n          onEnable={(isInitiatedByUser): void => {\n            setState((prevState) => ({\n              ...prevState,\n              isOriginExplicit:\n                !isInitiatedByUser && prevState.isOriginExplicit,\n              isGeolocating: true,\n            }));\n          }}\n          onDisable={(): void => {\n            setState((prevState) => ({\n              ...prevState,\n              isGeolocating: false,\n              geolocationPosition: null,\n            }));\n          }}\n          onGeolocate={onGeolocate}\n        />\n        {state.geolocationPosition != null && (\n          <Marker\n            offset={[-20, -20]}\n            longitude={state.geolocationPosition[1]}\n            latitude={state.geolocationPosition[0]}\n          >\n            <UserPosition dataTestId=\"user-marker\" />\n          </Marker>\n        )}\n        <Source\n          id=\"osm-qa-tiles\"\n          type=\"vector\"\n          tiles={[\"https://tile.olmap.org/osm-qa-tiles/{z}/{x}/{y}.pbf\"]}\n          minzoom={12}\n          maxzoom={12}\n        >\n          <Layer\n            source-layer=\"osm\"\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...allEntrancesLayer}\n            source=\"osm-qa-tiles\"\n          />\n          <Layer\n            source-layer=\"osm\"\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...allEntrancesSymbolLayer}\n            source=\"osm-qa-tiles\"\n          />\n        </Source>\n        <Source id=\"route\" type=\"geojson\" data={state.route}>\n          <Layer\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...routeLineLayer}\n            source=\"route\"\n          />\n          <Layer\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...routeImaginaryLineLayer}\n            source=\"route\"\n          />\n\n          <Layer\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...routePointLayer}\n            source=\"route\"\n          />\n          <Layer\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...routePointSymbolLayer}\n            source=\"route\"\n          />\n        </Source>\n        {state.origin && (\n          <Marker\n            className=\"PinMarker\"\n            draggable\n            offset={[0, -22.5]}\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            onDragEnd={(lngLat: any): void => {\n              setState(\n                (prevState): State => ({\n                  ...prevState,\n                  origin: [lngLat.lat, lngLat.lng],\n                  isOriginExplicit: true,\n                })\n              );\n            }}\n            longitude={state.origin[1]}\n            latitude={state.origin[0]}\n          >\n            <Pin\n              dataTestId=\"origin\"\n              style={{ fill: \"#00afff\", stroke: \"#fff\" }}\n            />\n          </Marker>\n        )}\n        {state.destination && (\n          <Marker\n            className=\"PinMarker\"\n            draggable\n            offset={[0, -22.5]}\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            onDragEnd={(lngLat: any): void => {\n              setState(\n                (prevState): State => ({\n                  ...prevState,\n                  destination: latLngToDestination([lngLat.lat, lngLat.lng]),\n                })\n              );\n            }}\n            longitude={state.destination.lon}\n            latitude={state.destination.lat}\n          >\n            <Pin\n              dataTestId=\"destination\"\n              style={{\n                fill: \"#64be14\",\n                stroke: \"#fff\",\n              }}\n            />\n          </Marker>\n        )}\n        {state.popupCoordinates != null && (\n          <Popup\n            latitude={state.popupCoordinates[0]}\n            longitude={state.popupCoordinates[1]}\n            closeButton={false}\n            closeOnClick\n            onClose={(): void =>\n              setState(\n                (prevState): State => ({ ...prevState, popupCoordinates: null })\n              )\n            }\n          >\n            <button\n              data-testid=\"origin-button\"\n              type=\"button\"\n              aria-label=\"Set origin\"\n              onClick={(): void =>\n                setState(\n                  (prevState): State => {\n                    // Check this to appease the compiler.\n                    if (prevState.popupCoordinates != null) {\n                      return {\n                        ...prevState,\n                        origin: prevState.popupCoordinates,\n                        isOriginExplicit: true,\n                        popupCoordinates: null,\n                      };\n                    }\n                    return {\n                      ...prevState,\n                      isOriginExplicit: true,\n                      popupCoordinates: null,\n                    };\n                  }\n                )\n              }\n            >\n              Origin\n            </button>\n            <button\n              data-testid=\"destination-button\"\n              type=\"button\"\n              aria-label=\"Set destination\"\n              onClick={(): void =>\n                setState(\n                  (prevState): State => {\n                    // Check this to appease the compiler.\n                    if (prevState.popupCoordinates != null) {\n                      return {\n                        ...prevState,\n                        destination: latLngToDestination(\n                          prevState.popupCoordinates\n                        ),\n                        popupCoordinates: null,\n                      };\n                    }\n                    return {\n                      ...prevState,\n                      popupCoordinates: null,\n                    };\n                  }\n                )\n              }\n            >\n              Destination\n            </button>\n          </Popup>\n        )}\n      </MapGL>\n    </div>\n  );\n};\n\nexport default App;\n"],"sourceRoot":""}